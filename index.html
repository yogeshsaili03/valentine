<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>üíó A Little Love Game</title>

  <!-- Premium fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* matte / premium tones */
      --bg1:#eeb7c6;
      --bg2:#f3d2db;
      --bg3:#fbf2f5;

      --paper: rgba(255, 252, 253, .82);
      --stroke: rgba(255,255,255,.62);
      --shadow: 0 24px 84px rgba(36, 10, 20, .14);

      --ink:#2b0f1d;
      --muted: rgba(43,15,29,.72);

      --accent1:#b51652;
      --accent2:#f08fb1;

      --radius: 28px;
      --btnShadow: 0 18px 40px rgba(181, 22, 82, .16);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      background:
        radial-gradient(900px 650px at 15% 15%, var(--bg3) 0%, transparent 58%),
        radial-gradient(900px 650px at 85% 20%, #ffe4ea 0%, transparent 60%),
        linear-gradient(125deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      overflow-x:hidden;
      overflow-y:auto;
    }

    /* subtle matte texture */
    .noise{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.055;
      mix-blend-mode: soft-light;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.30'/%3E%3C/svg%3E");
    }

    .wrap{
      min-height: 100svh;
      display:grid;
      place-items:center;
      padding: max(14px, env(safe-area-inset-top)) 14px max(18px, env(safe-area-inset-bottom));
    }

    .card{
      width: min(920px, 100%);
      border-radius: var(--radius);
      background: var(--paper);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      padding: clamp(16px, 4.2vw, 30px);
      position:relative;
      overflow:hidden;
    }

    .shine{
      position:absolute; inset:-170px -200px auto auto;
      width:420px; height:420px;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.72), rgba(255,255,255,0) 62%);
      transform: rotate(18deg);
      opacity:.85;
      pointer-events:none;
    }

    /* Audio toggle pill */
    .audioPill{
      position:absolute;
      top: 12px;
      right: 12px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 12px 26px rgba(36,10,20,.08);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      z-index: 50;
      backdrop-filter: blur(10px);
    }
    .audioPill .dot{
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: rgba(181,22,82,.85);
      box-shadow: 0 0 14px rgba(240,143,177,.35);
    }
    .audioPill .label{
      font-weight: 900;
      font-size: 12px;
      color: rgba(43,15,29,.80);
    }
    .audioPill button{
      border:0;
      border-radius: 999px;
      font-weight: 900;
      padding: 7px 10px;
      font-size: 12px;
      cursor:pointer;
      background: linear-gradient(135deg, rgba(181,22,82,.92), rgba(240,143,177,.92));
      color:#fff;
      box-shadow: 0 12px 26px rgba(181,22,82,.14);
    }
    .audioPill button.off{
      background: rgba(255,255,255,.86);
      color: rgba(43,15,29,.82);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 10px 22px rgba(36,10,20,.07);
    }

    .screens{ position: relative; min-height: 72svh; }
    .screen{ display:none; animation: fadeIn .25s ease-out; }
    .screen.active{ display:block; }

    @keyframes fadeIn{
      from{ opacity: 0; transform: translateY(8px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    h1,h2{
      margin:0;
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight:800;
      letter-spacing:.15px;
      line-height: 1.12;
      color: #240a14;
    }
    h1{ font-size: clamp(22px, 6.2vw, 44px); }
    h2{ font-size: clamp(20px, 6vw, 40px); }

    .sub{
      margin: 10px 0 0;
      text-align:center;
      font-size: clamp(12px, 3.6vw, 15px);
      color: var(--muted);
    }
    .name{ color: var(--accent1); }

    .divider{
      display:flex; align-items:center; justify-content:center;
      gap:12px;
      opacity:.85;
      margin: 12px 0 14px;
      font-size: 14px;
    }
    .divider::before, .divider::after{
      content:"";
      height:1px;
      width:min(220px, 24vw);
      background: linear-gradient(90deg, transparent, rgba(181,22,82,.25), transparent);
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    .btn{
      border:0;
      border-radius: 999px;
      padding: 12px 18px;
      font-family: Inter, system-ui;
      font-weight: 900;
      font-size: clamp(14px, 4.2vw, 18px);
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }
    .btn.primary{
      color:#fff;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: var(--btnShadow);
      position:relative;
      overflow:hidden;
    }
    .btn.primary::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.38) 42%, transparent 70%);
      transform: translateX(-130%) skewX(-18deg);
      animation: sweep 3.2s ease-in-out infinite;
      opacity:.55;
      pointer-events:none;
    }
    @keyframes sweep{
      0%{ transform: translateX(-130%) skewX(-18deg); }
      45%{ transform: translateX(150%) skewX(-18deg); }
      100%{ transform: translateX(150%) skewX(-18deg); }
    }

    .btn.ghost{
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(43,15,29,.12);
      color: rgba(43,15,29,.86);
      box-shadow: 0 10px 24px rgba(36,10,20,.08);
    }

    .btn:disabled{ opacity: .55; cursor:not-allowed; }

    /* ===== Screen 1: Calendar ===== */
    .paperBlock{
      margin-top: 14px;
      border-radius: 22px;
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      padding: 14px;
    }
    .monthTitle{
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: clamp(18px, 5.2vw, 30px);
      color: rgba(43,15,29,.88);
      margin: 4px 0 8px;
      letter-spacing: .2px;
    }
    .dowRow{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 8px;
      opacity:.80;
      padding-inline: 2px;
    }
    .dow{
      text-align:center;
      font-weight: 900;
      font-size: 12px;
      color: rgba(43,15,29,.78);
    }
    .calendarGrid{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 8px;
      align-items: center;
      justify-items: center;
      padding-inline: 2px;
    }
    .dateBtn{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border: 1px solid rgba(43,15,29,.08);
      background: rgba(255,255,255,.85);
      color: rgba(43,15,29,.88);
      font-weight: 900;
      font-size: clamp(12px, 3.6vw, 14px);
      display:grid;
      place-items:center;
      position:relative;
      cursor:pointer;
      user-select:none;
    }
    .blank{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border: 1px dashed rgba(43,15,29,.06);
      background: rgba(255,255,255,.25);
    }
    .dateBtn.selected{
      border-color: rgba(181,22,82,.30);
      box-shadow: 0 14px 30px rgba(181,22,82,.12);
      transform: translateY(-1px);
    }
    .dateBtn.selected::after{
      content:"üíó";
      position:absolute;
      bottom: -7px;
      right: -2px;
      font-size: 14px;
      filter: drop-shadow(0 8px 12px rgba(181,22,82,.12));
    }
    .dateBtn.suggest{
      border-color: rgba(181,22,82,.25);
      box-shadow: 0 18px 38px rgba(181,22,82,.18);
    }
    .dateBtn.suggest::before{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius: 18px;
      background: conic-gradient(
        from 180deg,
        rgba(181,22,82,0),
        rgba(181,22,82,.45),
        rgba(240,143,177,.55),
        rgba(181,22,82,.45),
        rgba(181,22,82,0)
      );
      filter: blur(6px);
      opacity:.8;
      animation: ringGlow 1.1s ease-in-out infinite;
      z-index:-1;
    }
    @keyframes ringGlow{
      0%,100%{ transform: scale(.98); opacity:.55; }
      50%{ transform: scale(1.03); opacity:.90; }
    }
    .noteLine{
      margin-top: 10px;
      text-align:center;
      font-weight: 800;
      color: rgba(43,15,29,.78);
      font-size: clamp(12px, 3.6vw, 15px);
      min-height: 1.7em;
    }

    /* ===== Screen 2: TicTacToe ===== */
    .tttWrap{ margin-top: 12px; display:grid; gap: 10px; }
    .tttTopWin{
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: clamp(16px, 4.8vw, 22px);
      color: rgba(43,15,29,.92);
      margin-top: 6px;
      min-height: 1.6em;
    }
    .tttTopWin.glow{
      text-shadow:
        0 0 16px rgba(181,22,82,.35),
        0 0 36px rgba(240,143,177,.35);
      animation: topGlow 1.1s ease-in-out infinite;
    }
    @keyframes topGlow{
      0%,100%{ opacity:.85; transform: translateY(0); }
      50%{ opacity:1; transform: translateY(-1px); }
    }
    .tttBoardShell{
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      position:relative;
      padding: 0 16px;
    }
    @media (max-width: 420px){
      .tttBoardShell{ padding: 0 18px; }
    }
    .tttBoard{
      width: 100%;
      margin: 0 auto;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(8px, 2.2vw, 10px);
      padding: clamp(10px, 2.6vw, 12px);
      border-radius: 22px;
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      touch-action: manipulation;
      overflow: hidden;
    }
    .cell{
      aspect-ratio: 1/1;
      border-radius: clamp(14px, 3.2vw, 18px);
      border: 1px solid rgba(43,15,29,.10);
      background: rgba(255,255,255,.90);
      font-weight: 900;
      font-size: clamp(22px, 7vw, 34px);
      font-family:"Playfair Display", serif;
      letter-spacing:.2px;
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      position:relative;
      overflow:hidden;
    }
    .cell.pop{ animation: popIn .22s ease-out; }
    @keyframes popIn{
      from{ transform: scale(.78); filter: blur(1px); opacity:.2; }
      to{ transform: scale(1); filter: blur(0); opacity:1; }
    }
    .cell.hint::after{
      content:"";
      position:absolute; inset: 10px;
      border-radius: 14px;
      border: 2px dashed rgba(181,22,82,.32);
      animation: pulse 1.1s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes pulse{
      0%,100%{ opacity:.35; transform: scale(.98); }
      50%{ opacity:.75; transform: scale(1.02); }
    }
    .tttStatus{
      text-align:center;
      font-weight: 900;
      font-size: clamp(13px, 3.8vw, 16px);
      color: rgba(43,15,29,.82);
      min-height: 1.6em;
    }
    .winSvg{
      position:absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events:none;
    }

    /* ===== Screen 3: Valentine ===== */
    .emojiRow{
      display:grid;
      place-items:center;
      gap: 8px;
      margin-top: 12px;
    }
    .emoji{
      font-size: clamp(52px, 15vw, 92px);
      line-height: 1;
      will-change: transform;
    }
    .mood{
      text-align:center;
      font-weight: 900;
      font-size: clamp(13px, 3.9vw, 16px);
      color: rgba(43,15,29,.84);
      min-height: 2.0em;
      padding: 0 8px;
    }

    .arena{
      margin-top: 10px;
      position:relative;
      height: clamp(310px, 46vh, 520px);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.55);
      background: rgba(255,255,255,.38);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      overflow:hidden;
    }

    /* YES hold-to-fill water effect */
    .chargeBtn{
      position:absolute;
      left:50%;
      bottom: 14px;
      transform: translateX(-50%);
      width: min(360px, 86vw);
      height: 56px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      overflow:hidden;
      touch-action: none;
    }
    .chargeBtn .yesText{ position:relative; z-index: 2; }
    .chargeBtn .chargePct{ position:relative; z-index: 2; font-weight: 900; opacity: .92; }
    .chargeBtn .wave{
      position:absolute;
      left:0; bottom:0;
      width:100%;
      height:0%;
      z-index:1;
      opacity:.95;
      border-radius: 999px;
      background:
        radial-gradient(18px 12px at 18% 24%, rgba(255,255,255,.35), transparent 65%),
        radial-gradient(22px 16px at 70% 35%, rgba(255,255,255,.22), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.05)),
        linear-gradient(135deg, rgba(181,22,82,.95), rgba(240,143,177,.95));
      transform: translateY(8px);
      will-change: transform, height, filter;
    }
    .chargeBtn .wave::after{
      content:"";
      position:absolute;
      left:-30%;
      top:8px;
      width:160%;
      height:22px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.28), transparent);
      filter: blur(1px);
      opacity:.7;
      animation: waveSweep 1.35s ease-in-out infinite;
    }
    @keyframes waveSweep{
      0%{ transform: translateX(-25%); }
      50%{ transform: translateX(18%); }
      100%{ transform: translateX(-25%); }
    }
    .chargeBtn.charged{
      box-shadow: 0 22px 50px rgba(181,22,82,.24);
    }

    /* bubbles inside wave */
    .bubble{
      position:absolute;
      bottom: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.65);
      opacity: 0;
      pointer-events:none;
      filter: blur(.1px);
      will-change: transform, opacity;
    }

    /* Catch-the-heart */
    .catchHeart{
      position:absolute;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 16px 34px rgba(181,22,82,.12);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      z-index: 7;
      touch-action: manipulation;
    }
    .catchHeart span{
      font-size: 26px;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.12));
      animation: heartPulse 1.4s ease-in-out infinite;
    }
    @keyframes heartPulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.12); }
    }

    #noWrap{
      position:absolute;
      left:0; top:0;
      z-index: 5;
      will-change: transform, opacity, filter;
    }
    #noBtn{
      padding: 9px 12px;
      font-size: clamp(12px, 3.6vw, 14px);
      width: auto;
      max-width: 70vw;
      white-space: normal;
      line-height: 1.15;
    }

    .hint{
      text-align:center;
      font-size: 12.5px;
      color: rgba(43,15,29,.66);
      margin-top: 10px;
    }

    /* dust layer for thanos effect */
    .dustLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 6;
    }
    .dust{
      position:absolute;
      opacity: 0;
      will-change: transform, opacity, filter;
      mix-blend-mode: multiply;
      border-radius: 999px;
    }
    .spark{
      position:absolute;
      width: 2px;
      height: 2px;
      border-radius: 50%;
      background: rgba(255,255,255,.85);
      filter: drop-shadow(0 0 10px rgba(240,143,177,.9));
      opacity: 0;
      pointer-events:none;
    }

    /* ===== Screen 4: Final ===== */
    .finalWrap{ position: relative; margin-top: 14px; }
    .finalBox{
      border-radius: 22px;
      background: rgba(255,255,255,.46);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      padding: 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
      isolation: isolate;
    }
    .finalBox::before{
      content:"";
      position:absolute;
      inset:-60px;
      background: radial-gradient(circle at 30% 20%, rgba(240,143,177,.28), transparent 62%),
                  radial-gradient(circle at 70% 20%, rgba(181,22,82,.20), transparent 60%),
                  radial-gradient(circle at 50% 90%, rgba(255,255,255,.30), transparent 60%);
      filter: blur(10px);
      opacity:.95;
      z-index: -1;
      animation: finalGlow 3.8s ease-in-out infinite;
    }
    @keyframes finalGlow{
      0%,100%{ transform: translateY(0) scale(1); opacity:.85; }
      50%{ transform: translateY(-6px) scale(1.02); opacity:1; }
    }
    .finalBox::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.22) 38%, transparent 70%);
      transform: translateX(-140%) skewX(-18deg);
      animation: finalSweep 4.2s ease-in-out infinite;
      pointer-events:none;
      z-index: 0;
    }
    @keyframes finalSweep{
      0%{ transform: translateX(-140%) skewX(-18deg); }
      45%{ transform: translateX(160%) skewX(-18deg); }
      100%{ transform: translateX(160%) skewX(-18deg); }
    }
    .finalEmoji{
      font-size: clamp(68px, 18vw, 110px);
      line-height:1;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
      filter: drop-shadow(0 18px 22px rgba(181,22,82,.12));
      animation: heartbeat 1.6s ease-in-out infinite;
    }
    @keyframes heartbeat{
      0%,100%{ transform: scale(1); }
      18%{ transform: scale(1.08); }
      36%{ transform: scale(1.0); }
      55%{ transform: scale(1.06); }
      72%{ transform: scale(1.0); }
    }
    .finalLine{
      font-weight: 900;
      color: rgba(43,15,29,.82);
      font-size: clamp(13px, 3.9vw, 16px);
      position: relative;
      z-index: 1;
    }
    .finalLine.glowy{
      text-shadow:
        0 0 16px rgba(181,22,82,.20),
        0 0 34px rgba(240,143,177,.18);
      animation: textGlow 2.2s ease-in-out infinite;
    }
    @keyframes textGlow{
      0%,100%{ opacity:.92; transform: translateY(0); }
      50%{ opacity:1; transform: translateY(-1px); }
    }
    .cheesyGrid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 720px){
      .cheesyGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .noteCard{
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(43,15,29,.08);
      box-shadow: 0 14px 38px rgba(36,10,20,.08);
      padding: 12px 12px 10px;
      position:relative;
      overflow:hidden;
      animation: cardFloat 4.2s ease-in-out infinite;
    }
    .noteCard:nth-child(2){ animation-delay: .4s; }
    .noteCard:nth-child(3){ animation-delay: .8s; }
    .noteCard:nth-child(4){ animation-delay: 1.2s; }
    .noteCard:nth-child(5){ animation-delay: 1.6s; }
    .noteCard:nth-child(6){ animation-delay: 2.0s; }
    @keyframes cardFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
    }
    .noteCard::after{
      content:"";
      position:absolute;
      inset: 0;
      background: radial-gradient(220px 140px at 30% 10%, rgba(240,143,177,.18), transparent 60%);
      pointer-events:none;
    }
    .noteTitle{
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: 14px;
      letter-spacing:.15px;
      color: rgba(43,15,29,.92);
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }
    .noteText{
      font-weight: 800;
      font-size: 12.5px;
      color: rgba(43,15,29,.76);
      line-height: 1.25;
      position: relative;
      z-index: 1;
    }
    .noteIcon{
      position:absolute;
      right: 10px;
      top: 10px;
      opacity:.95;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.10));
      animation: iconGlow 2.8s ease-in-out infinite;
      z-index: 1;
    }
    @keyframes iconGlow{
      0%,100%{ transform: scale(1); opacity:.92; }
      50%{ transform: scale(1.06); opacity:1; }
    }
    .heartLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 2;
      border-radius: 22px;
    }
    .floatHeart{
      position:absolute;
      opacity: 0;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.10));
      will-change: transform, opacity;
    }
  </style>
</head>

<body>
  <div class="noise"></div>

  <div class="wrap">
    <div class="card">
      <div class="shine"></div>

      <!-- Audio toggle -->
      <div class="audioPill" id="audioPill">
        <div class="dot" id="audioDot"></div>
        <div class="label" id="audioLabel">Sound: ON</div>
        <button id="audioToggle">Mute</button>
      </div>

      <div class="screens">

        <!-- SCREEN 1 -->
        <section class="screen active" id="s1">
          <h1>Let‚Äôs start with a memory ‚ú®</h1>
          <div class="divider">üíû</div>
          <p class="sub">Tap the date‚Ä¶ <b>when we met</b> üíó</p>

          <div class="paperBlock">
            <div class="monthTitle" id="monthTitle">December 2022</div>
            <div class="dowRow" id="dowRow"></div>
            <div class="calendarGrid" id="calendarGrid"></div>
            <div class="noteLine" id="dateNote">Choose our day‚Ä¶</div>
          </div>

          <div class="row">
            <button class="btn primary" id="toS2" disabled>Next ‚ûú</button>
          </div>
        </section>

        <!-- SCREEN 2 -->
        <section class="screen" id="s2">
          <h1>Mini game üéÆ</h1>
          <div class="divider">üíó</div>
          <p class="sub">Win this and you win‚Ä¶ something cute üòâ</p>

          <div class="tttTopWin" id="tttTopWin"></div>

          <div class="tttWrap">
            <div class="tttBoardShell" id="tttShell">
              <svg class="winSvg" id="winSvg"></svg>
              <div class="tttBoard" id="tttBoard"></div>
            </div>
            <div class="tttStatus" id="tttStatus">Your turn üíó</div>
          </div>

          <div class="row">
            <button class="btn ghost" id="resetTTT">Restart</button>
            <button class="btn primary" id="toS3" disabled>Next ‚ûú</button>
          </div>
        </section>

        <!-- SCREEN 3 -->
        <section class="screen" id="s3">
          <h1>One more question‚Ä¶</h1>
          <div class="divider">üíû</div>

          <h2 id="valQuestion" style="
            margin-top: 6px;
            font-family:'Playfair Display', serif;
            font-weight:800;
            text-align:center;
            font-size: clamp(20px, 6vw, 38px);
            color:#240a14;
          ">
            Will you be my Valentine, <span class="name" id="cutieNameInline"></span>? üíò
          </h2>

          <p class="sub" id="valSub">Since <span class="name">our day</span>, I‚Äôve been smiling more.</p>

          <div class="emojiRow">
            <div class="emoji" id="valEmoji">üòä</div>
            <div class="mood" id="valMood">Be honest‚Ä¶ but be gentle üòå</div>
          </div>

          <div class="arena" id="arena">
            <!-- Catch the heart -->
            <div class="catchHeart" id="catchHeart" title="Catch me!">
              <span>üíó</span>
            </div>

            <!-- YES hold to fill -->
            <button class="btn primary chargeBtn" id="yesBtn" type="button" aria-label="Hold to say yes">
              <span class="yesText" id="yesText">Hold to say YES üíò</span>
              <span class="chargePct" id="chargePct">0%</span>
              <span class="wave" id="wave"></span>
            </button>

            <!-- NO -->
            <div id="noWrap" aria-hidden="true">
              <button class="btn ghost" id="noBtn" type="button">No üôà</button>
            </div>

            <div id="dustLayer" class="dustLayer"></div>
          </div>

          <div class="hint">Tap ‚ÄúNo‚Äù for excuses üòå ‚Ä¢ Catch the üíó for boosts ‚Ä¢ Hold YES to fill üåä</div>
        </section>

        <!-- SCREEN 4 -->
        <section class="screen" id="s4">
          <h2>Yayyy!! üíû</h2>
          <div class="divider">üåπ</div>

          <div class="finalWrap">
            <div class="finalBox">
              <div class="heartLayer" id="heartLayer"></div>

              <div class="finalEmoji" id="finalEmoji">üòç</div>
              <div class="finalLine glowy" id="finalLine1">You have won my heart.</div>
              <div class="finalLine glowy" id="finalLine2" style="margin-top:6px;">Happy Valentine‚Äôs Day ‚ú®</div>
            </div>

            <div class="cheesyGrid" id="cheesyGrid"></div>
          </div>

          <div class="row">
            <button class="btn ghost" id="replay">Play again ‚Üª</button>
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script>
    // =======================
    // CONFIG (edit these)
    // =======================
    const CUTIE_NAME = "CUTIE_NAME";

    const MONTH_NAME = "December";
    const YEAR = 2022;
    const DAYS_IN_MONTH = 31;

    // 0=Mon, 1=Tue, 2=Wed, 3=Thu, 4=Fri, 5=Sat, 6=Sun
    const MONTH_START_DOW = 2; // Dec 1, 2022 was Wednesday ‚úÖ

    // Set correct day (1..DAYS_IN_MONTH) or null to disable
    const CORRECT_DAY = 18;

    // =======================
    // WebAudio (no external files) - sounds for all games
    // =======================
    const audioUI = {
      enabled: true,
      ctx: null,
      master: null,
      unlocked: false
    };

    const audioToggle = document.getElementById("audioToggle");
    const audioLabel  = document.getElementById("audioLabel");
    const audioDot    = document.getElementById("audioDot");

    function updateAudioUI(){
      audioLabel.textContent = `Sound: ${audioUI.enabled ? "ON" : "OFF"}`;
      audioToggle.textContent = audioUI.enabled ? "Mute" : "Unmute";
      audioToggle.classList.toggle("off", !audioUI.enabled);
      audioDot.style.opacity = audioUI.enabled ? "1" : ".35";
    }
    updateAudioUI();

    function ensureAudio(){
      if(!audioUI.enabled) return false;
      if(audioUI.ctx) return true;

      try{
        audioUI.ctx = new (window.AudioContext || window.webkitAudioContext)();
        audioUI.master = audioUI.ctx.createGain();
        audioUI.master.gain.value = 0.28; // overall volume
        audioUI.master.connect(audioUI.ctx.destination);
        return true;
      }catch(e){
        return false;
      }
    }

    async function unlockAudio(){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      if(audioUI.unlocked) return;
      try{
        if(audioUI.ctx.state !== "running") await audioUI.ctx.resume();
        // tiny silent tick to "prime"
        const o = audioUI.ctx.createOscillator();
        const g = audioUI.ctx.createGain();
        g.gain.value = 0.0001;
        o.connect(g); g.connect(audioUI.master);
        o.frequency.value = 440;
        o.start();
        o.stop(audioUI.ctx.currentTime + 0.01);
        audioUI.unlocked = true;
      }catch(e){}
    }

    audioToggle.addEventListener("click", async () => {
      audioUI.enabled = !audioUI.enabled;
      updateAudioUI();
      if(audioUI.enabled) await unlockAudio();
    });

    // small helper building blocks
    function now(){ return audioUI.ctx ? audioUI.ctx.currentTime : 0; }

    function tone(freq=440, dur=0.08, type="sine", gain=0.06, slide=0){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      const t0 = now();

      const o = audioUI.ctx.createOscillator();
      const g = audioUI.ctx.createGain();
      const f = Math.max(40, freq);

      o.type = type;
      o.frequency.setValueAtTime(f, t0);
      if(slide) o.frequency.exponentialRampToValueAtTime(Math.max(40, f+slide), t0 + dur);

      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(gain, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

      o.connect(g); g.connect(audioUI.master);
      o.start(t0);
      o.stop(t0 + dur + 0.02);
    }

    function noiseBurst(dur=0.08, gain=0.03){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      const t0 = now();
      const bufferSize = Math.floor(audioUI.ctx.sampleRate * dur);
      const buffer = audioUI.ctx.createBuffer(1, bufferSize, audioUI.ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for(let i=0;i<bufferSize;i++){
        data[i] = (Math.random()*2 - 1) * (1 - i/bufferSize);
      }

      const src = audioUI.ctx.createBufferSource();
      src.buffer = buffer;

      const filt = audioUI.ctx.createBiquadFilter();
      filt.type = "highpass";
      filt.frequency.value = 1200;

      const g = audioUI.ctx.createGain();
      g.gain.setValueAtTime(gain, t0);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

      src.connect(filt); filt.connect(g); g.connect(audioUI.master);
      src.start(t0);
      src.stop(t0 + dur + 0.02);
    }

    // semantic sounds
    const SFX = {
      tap(){ tone(520, 0.06, "sine", 0.05, 80); },
      soft(){ tone(320, 0.08, "triangle", 0.03, -20); },
      wrong(){ tone(220, 0.12, "sawtooth", 0.04, -40); noiseBurst(0.06, 0.02); },
      correct(){ tone(660, 0.06, "sine", 0.055, 90); setTimeout(()=>tone(880,0.07,"sine",0.045,120), 50); },
      win(){ tone(740, 0.09, "triangle", 0.06, 90); setTimeout(()=>tone(980,0.10,"triangle",0.05,140), 80); setTimeout(()=>tone(1240,0.12,"sine",0.045,200), 160); },
      boop(){ tone(420, 0.08, "square", 0.035, 30); },
      snap(){ noiseBurst(0.13, 0.04); tone(180, 0.10, "sawtooth", 0.02, -60); },
      bubble(){ tone(560, 0.04, "sine", 0.02, 60); },
      sparkle(){ tone(900, 0.05, "sine", 0.035, 150); setTimeout(()=>tone(1250,0.06,"sine",0.03,200), 40); },
      charge(){ tone(250, 0.06, "triangle", 0.02, 40); }
    };

    // unlock audio on first user interaction anywhere
    window.addEventListener("pointerdown", unlockAudio, { once:false, passive:true });

    // =======================
    // Global state
    // =======================
    const state = { metDay: null, tttWon: false };

    // =======================
    // Helpers
    // =======================
    function showScreen(id){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      window.scrollTo({top: 0, behavior: "smooth"});
      if(id === "s4") startFinalEffects();
    }
    function pick(arr){ return arr[(Math.random() * arr.length) | 0]; }

    function distanceBucket(diff){
      if(diff === 0) return "exact";
      if(diff === 1) return "one";
      if(diff <= 3) return "near";
      if(diff <= 7) return "mid";
      return "far";
    }

    function wrongDayMessage(day){
      const diff = Math.abs(day - CORRECT_DAY);
      const bucket = distanceBucket(diff);
      const msgs = {
        one: [
          "Oof‚Ä¶ SO close üò≠ Just one day away üíó",
          "Almost! You‚Äôre literally 1 day off üòå‚ú®",
          "My heart says‚Ä¶ ‚Äòone tiny step‚Äô üíû",
          "You nearly nailed it ü•∫ (just 1 day!)"
        ],
        near: [
          "Closeee üòå Try the glowing date üíó",
          "You‚Äôre in the neighborhood üè°‚ú® (look for the ring)",
          "Warm warm warm üî•üíó The glow will guide you",
          "Not perfect‚Ä¶ but cute attempt ü•∫üíû"
        ],
        mid: [
          "Hmm‚Ä¶ not quite üòå Follow the glowing ring üíó",
          "A little off‚Ä¶ but I like the confidence üòè‚ú®",
          "We‚Äôre drifting üò≠ Find the shining date üíû",
          "Nope üôà but I‚Äôll help‚Äîwatch the glow üíó"
        ],
        far: [
          "That‚Äôs‚Ä¶ very wrong üò≠üòÇ The glow will save you üíó",
          "Aww nooo üôà That‚Äôs far‚Ä¶ look for the shining ring ‚ú®",
          "We weren‚Äôt even close ü•∫üíû Try the glowing date",
          "My calendar just blushed and panicked üòÇüíó Follow the glow"
        ],
        exact: [
          `YESSS üòç ${MONTH_NAME} ${CORRECT_DAY}, ${YEAR} üíó`,
          `Perfect! You remembered ü•πüíû ${MONTH_NAME} ${CORRECT_DAY}, ${YEAR}`,
          `That‚Äôs the one! My heart approves üíò`,
          `Correct üòåüíó (I knew you‚Äôd get it)`
        ]
      };
      return pick(msgs[bucket] || msgs.mid);
    }

    // =======================
    // SCREEN 1: Calendar
    // =======================
    const monthTitle = document.getElementById("monthTitle");
    const calendarGrid = document.getElementById("calendarGrid");
    const dowRow = document.getElementById("dowRow");
    const dateNote = document.getElementById("dateNote");
    const toS2 = document.getElementById("toS2");

    monthTitle.textContent = `${MONTH_NAME} ${YEAR}`;
    const DOW = ["M","T","W","T","F","S","S"];
    dowRow.innerHTML = DOW.map(d => `<div class="dow">${d}</div>`).join("");

    function buildCalendar(){
      calendarGrid.innerHTML = "";
      for(let i=0;i<MONTH_START_DOW;i++){
        const b = document.createElement("div");
        b.className = "blank";
        calendarGrid.appendChild(b);
      }
      for(let d=1; d<=DAYS_IN_MONTH; d++){
        const btn = document.createElement("button");
        btn.className = "dateBtn";
        btn.type = "button";
        btn.textContent = d;
        btn.dataset.day = String(d);
        btn.addEventListener("click", () => selectDay(d, btn));
        calendarGrid.appendChild(btn);
      }
    }

    function suggestCorrectDay(){
      if(!CORRECT_DAY) return;
      const el = calendarGrid.querySelector(`.dateBtn[data-day="${CORRECT_DAY}"]`);
      if(!el) return;

      let intensity = 1;
      if(state.metDay && CORRECT_DAY){
        const diff = Math.abs(state.metDay - CORRECT_DAY);
        intensity = diff <= 1 ? 1.2 : diff <= 3 ? 1.1 : diff <= 7 ? 1.0 : 0.92;
      }

      el.classList.add("suggest");
      el.style.transform = `scale(${intensity})`;
      setTimeout(() => {
        el.classList.remove("suggest");
        el.style.transform = "";
      }, 1200);
    }

    function selectDay(day, btn){
      SFX.tap();

      state.metDay = day;
      document.querySelectorAll(".dateBtn").forEach(x => x.classList.remove("selected"));
      btn.classList.add("selected");
      toS2.disabled = false;

      if(CORRECT_DAY){
        if(day !== CORRECT_DAY){
          dateNote.textContent = wrongDayMessage(day);
          suggestCorrectDay();
          SFX.wrong();
        } else {
          dateNote.textContent = wrongDayMessage(day);
          SFX.correct();
        }
      } else {
        dateNote.textContent = `So‚Ä¶ ${MONTH_NAME} ${day}, ${YEAR} üíó`;
        SFX.soft();
      }

      gsap.fromTo(btn, {scale:0.96}, {scale:1.03, duration:0.16, ease:"power2.out", yoyo:true, repeat:1});
    }

    buildCalendar();

    toS2.addEventListener("click", () => { SFX.sparkle(); showScreen("s2"); initTTT(); });

    // =======================
    // SCREEN 2: TicTacToe (user always wins)
    // =======================
    const tttBoard = document.getElementById("tttBoard");
    const tttStatus = document.getElementById("tttStatus");
    const tttTopWin = document.getElementById("tttTopWin");
    const winSvg = document.getElementById("winSvg");
    const toS3 = document.getElementById("toS3");
    const resetTTT = document.getElementById("resetTTT");

    const USER = "üíó";
    const AI = "üñ§";

    const LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let board = Array(9).fill(null);
    let userMoves = 0;
    let locked = false;

    function renderTTT(){
      tttBoard.innerHTML = "";
      board.forEach((v, i) => {
        const c = document.createElement("div");
        c.className = "cell";
        c.dataset.i = String(i);
        c.textContent = v ? v : "";
        if(v) c.classList.add("pop");
        c.addEventListener("click", () => onUserMove(i));
        if(v) c.style.cursor = "default";
        tttBoard.appendChild(c);
      });
    }

    function animateCell(i){
      const el = tttBoard.querySelector(`.cell[data-i="${i}"]`);
      if(!el) return;
      gsap.fromTo(el, {scale:0.88}, {scale:1.04, duration:0.18, ease:"power2.out", yoyo:true, repeat:1});
    }

    function winningLine(sym){
      for(const line of LINES){
        if(line.every(idx => board[idx] === sym)) return line;
      }
      return null;
    }

    function bestLineForUser(){
      let best = null;
      let bestCount = -1;
      for(const line of LINES){
        const aiCount = line.filter(i => board[i] === AI).length;
        if(aiCount > 0) continue;
        const uCount = line.filter(i => board[i] === USER).length;
        if(uCount > bestCount){
          bestCount = uCount;
          best = line;
        }
      }
      return best || LINES[0];
    }

    function hintBestMove(){
      const cells = [...tttBoard.querySelectorAll(".cell")];
      cells.forEach(c => c.classList.remove("hint"));
      const line = bestLineForUser();
      const empty = line.find(i => !board[i]);
      if(empty != null){
        const el = tttBoard.querySelector(`.cell[data-i="${empty}"]`);
        if(el) el.classList.add("hint");
      }
    }

    function aiMoveSoft(){
      if(winningLine(USER)) return;
      const line = bestLineForUser();
      const avoid = new Set(line);

      const empties = board.map((v,i)=>v?null:i).filter(v=>v!==null);
      let choices = empties.filter(i => !avoid.has(i));
      if(choices.length === 0) choices = empties;

      const pickI = choices[Math.floor(Math.random()*choices.length)];
      board[pickI] = AI;
      renderTTT();
      animateCell(pickI);
      SFX.soft();
    }

    function forceUserWin(){
      const line = bestLineForUser();
      const empties = line.filter(i => !board[i]);
      if(empties.length){
        board[empties[0]] = USER;
        renderTTT();
        animateCell(empties[0]);
        SFX.tap();
      }
      if(winningLine(USER)) winTTT();
    }

    function countInLine(sym, line){ return line.filter(i => board[i] === sym).length; }
    function emptyInLine(line){ return line.filter(i => !board[i]).length; }
    function userAlmostWinning(){ return LINES.some(line => countInLine(USER, line) === 2 && emptyInLine(line) === 1); }
    function userCloseLines(){ return LINES.some(line => countInLine(USER, line) === 1 && emptyInLine(line) === 2); }

    function onUserMove(i){
      if(locked) return;
      if(board[i]) return;

      board[i] = USER;
      userMoves++;
      renderTTT();
      animateCell(i);
      SFX.tap();

      if(winningLine(USER)){ winTTT(); return; }

      if(userAlmostWinning()){
        tttStatus.textContent = pick(["OMG one more and you win üò≥üíû","Final move incoming‚Ä¶ üòåüíó","So close I can feel it ü•πüíò"]);
      } else if(userCloseLines()){
        tttStatus.textContent = pick(["That was cute üòåüíó","Okayyy I see you üëÄüíû","Ooo this is getting serious üíò"]);
      } else {
        tttStatus.textContent = pick(["Your turn üíó","Go on üòå","Make it count üíò"]);
      }

      locked = true;
      setTimeout(() => {
        aiMoveSoft();
        locked = false;

        if(winningLine(USER)){ winTTT(); return; }
        if(userMoves >= 4) forceUserWin();
        hintBestMove();
      }, 230);
    }

    function drawWinLine(line){
      const a = tttBoard.querySelector(`.cell[data-i="${line[0]}"]`);
      const c = tttBoard.querySelector(`.cell[data-i="${line[2]}"]`);
      if(!a || !c) return;

      const br = tttBoard.getBoundingClientRect();
      const ar = a.getBoundingClientRect();
      const cr = c.getBoundingClientRect();

      const x1 = (ar.left + ar.width/2) - br.left;
      const y1 = (ar.top + ar.height/2) - br.top;
      const x2 = (cr.left + cr.width/2) - br.left;
      const y2 = (cr.top + cr.height/2) - br.top;

      winSvg.setAttribute("viewBox", `0 0 ${br.width} ${br.height}`);
      winSvg.innerHTML = `
        <path id="p" d="M ${x1} ${y1} L ${x2} ${y2}"
              stroke="rgba(181,22,82,.85)"
              stroke-width="8"
              stroke-linecap="round"
              fill="none"
              opacity="0.95"/>
        <text id="heartEnd" x="${x2}" y="${y2}" text-anchor="middle" dominant-baseline="middle"
              style="font-size:22px; filter: drop-shadow(0 12px 16px rgba(181,22,82,.18));">üíó</text>
      `;

      const path = winSvg.querySelector("#p");
      const heart = winSvg.querySelector("#heartEnd");
      const len = path.getTotalLength();

      path.style.strokeDasharray = `${len}`;
      path.style.strokeDashoffset = `${len}`;

      gsap.to(path, { strokeDashoffset: 0, duration: 0.45, ease: "power2.out" });
      gsap.fromTo(path, { opacity: 0.65 }, { opacity: 1, duration: 0.18, yoyo: true, repeat: 3, ease: "power2.inOut" });
      gsap.fromTo(heart, { scale: 0.9 }, { scale: 1.22, duration: 0.18, yoyo: true, repeat: 3, ease: "power2.inOut",
        transformOrigin: "50% 50%"
      });
    }

    function winTTT(){
      state.tttWon = true;
      const line = winningLine(USER);
      if(line) drawWinLine(line);

      tttTopWin.textContent = "YOU HAVE WON MY HEART üíû";
      tttTopWin.classList.add("glow");
      setTimeout(() => tttTopWin.classList.remove("glow"), 1300);

      tttStatus.textContent = pick(["Okay okay‚Ä¶ you win üòåüíó","I surrender ü•πüíû","Fine‚Ä¶ take my heart üíò"]);
      toS3.disabled = false;

      SFX.win();
      confetti({ particleCount: 90, spread: 70, startVelocity: 22, scalar: 0.9, origin: { y: 0.55 } });
    }

    function initTTT(){
      state.tttWon = false;
      toS3.disabled = true;
      tttTopWin.textContent = "";
      tttTopWin.classList.remove("glow");
      winSvg.innerHTML = "";
      board = Array(9).fill(null);
      userMoves = 0;
      locked = false;
      tttStatus.textContent = "Your turn üíó";
      renderTTT();
      hintBestMove();
    }

    resetTTT.addEventListener("click", () => { SFX.wrong(); initTTT(); });

    // =======================
    // SCREEN 3: Valentine (Thanos dust + slosh + catch heart + bubbles + sound)
    // =======================
    const arena = document.getElementById("arena");
    const yesBtn = document.getElementById("yesBtn");
    const noWrap = document.getElementById("noWrap");
    const noBtn = document.getElementById("noBtn");
    const dustLayer = document.getElementById("dustLayer");
    const valEmoji = document.getElementById("valEmoji");
    const valMood = document.getElementById("valMood");
    const wave = document.getElementById("wave");
    const yesText = document.getElementById("yesText");
    const chargePct = document.getElementById("chargePct");
    const catchHeart = document.getElementById("catchHeart");

    document.getElementById("cutieNameInline").textContent = CUTIE_NAME;

    const REASONS = [
      "I only accept YES üíó",
      "No is on vacation üåô",
      "Not today üôà",
      "Ask me nicely üòå",
      "My heart says NO‚Ä¶ to NO üíû",
      "Try YES, it‚Äôs cute üåπ",
      "System error: NO blocked ‚ú®",
      "I‚Äôm shy‚Ä¶ choose YES ü•∫"
    ];

    let noBusy = false;

    // YES charging
    let charge = 0;
    let charging = false;
    let chargeRaf = null;
    let lastTs = 0;
    let noClicks = 0;
    let loveBoost = 0;
    let boostDecayTimer = null;

    // Motion slosh
    let motionEnabled = false;

    function setSlosh(tx, ty){
      const clampedX = Math.max(-1, Math.min(1, tx));
      const clampedY = Math.max(-1, Math.min(1, ty));

      gsap.to(wave, {
        rotate: clampedX * 3.2,
        x: clampedX * 10,
        y: clampedY * 6,
        transformOrigin: "50% 100%",
        duration: 0.25,
        ease: "power2.out"
      });

      gsap.to(yesBtn, {
        rotation: clampedX * 0.8,
        duration: 0.35,
        ease: "power2.out"
      });
    }

    function enableMotion(){
      if(motionEnabled) return;
      motionEnabled = true;

      window.addEventListener("deviceorientation", (e) => {
        const gx = (e.gamma ?? 0) / 25;
        const by = (e.beta ?? 0) / 25;
        setSlosh(gx, by);
      }, { passive: true });

      window.addEventListener("mousemove", (e) => {
        const cx = (e.clientX / window.innerWidth) * 2 - 1;
        const cy = (e.clientY / window.innerHeight) * 2 - 1;
        setSlosh(cx, cy);
      }, { passive: true });
    }

    function arenaMetrics(){
      const r = arena.getBoundingClientRect();
      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;
      return { r, bw, bh };
    }

    function yesRectInArena(){
      const ar = arena.getBoundingClientRect();
      const yr = yesBtn.getBoundingClientRect();
      return {
        left: yr.left - ar.left,
        top: yr.top - ar.top,
        right: yr.right - ar.left,
        bottom: yr.bottom - ar.top
      };
    }

    function overlapsYes(x, y){
      const pad = 16;
      const { bw, bh } = arenaMetrics();
      const a = { left:x-pad, top:y-pad, right:x+bw+pad, bottom:y+bh+pad };
      const b = yesRectInArena();
      return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
    }

    function randomSpot(){
      const { r, bw, bh } = arenaMetrics();
      const minX = 10, minY = 10;
      const maxX = Math.max(minX, r.width - bw - 10);
      const maxY = Math.max(minY, r.height - bh - 10);

      for(let i=0;i<120;i++){
        const x = minX + Math.random()*(maxX - minX);
        const y = minY + Math.random()*(maxY - minY);
        if(!overlapsYes(x,y)) return {x,y};
      }
      return {x: minX, y: minY};
    }

    function moveNoTo(target, instant=false){
      if(instant){
        gsap.set(noWrap, { x: target.x, y: target.y, opacity: 1, scale: 1, filter:"blur(0px)" });
        return;
      }
      gsap.to(noWrap, { x: target.x, y: target.y, duration: 0.40, ease: "power3.out", overwrite: true });
    }

    function randomHeartSpot(){
      const r = arena.getBoundingClientRect();
      const size = 52;
      const pad = 10;
      const minX = pad, minY = pad + 8;
      const maxX = Math.max(minX, r.width - size - pad);
      const maxY = Math.max(minY, r.height - size - pad - 72); // keep away from YES
      return { x: minX + Math.random()*(maxX-minX), y: minY + Math.random()*(maxY-minY) };
    }

    function moveCatchHeart(instant=false){
      const t = randomHeartSpot();
      if(instant){
        gsap.set(catchHeart, { x: t.x, y: t.y, opacity: 1, scale: 1 });
      }else{
        gsap.to(catchHeart, { x: t.x, y: t.y, duration: 0.55, ease:"power3.out", overwrite:true });
      }
    }

    // dynamic moods
    function setValMood(kind, text){
      const moods = {
        yes: [
          { e:"üòç", m:"YES?? üò≠üíó My heart just did a backflip." },
          { e:"ü•π", m:"Stoppp‚ÄîI'm melting ü•πüíû" },
          { e:"üíì", m:"Okay‚Ä¶ heart is beating FAST üíì" },
          { e:"üòò", m:"Come here you üòòüíò" },
          { e:"ü§≠", m:"Hehe‚Ä¶ I knew you‚Äôd say yes ü§≠üíó" }
        ],
        no: [
          { e:"ü•∫", m:"Ouch‚Ä¶ my tiny heart üíîü•∫" },
          { e:"üò§", m:"Hmph üò§ (I‚Äôm pretending I‚Äôm okay)" },
          { e:"üò∂‚Äçüå´Ô∏è", m:"I‚Äôm disappearing‚Ä¶ like your ‚ÄòNo‚Äô üò∂‚Äçüå´Ô∏è‚ú®" },
          { e:"üò≠", m:"Why would you do that to me üò≠üíû" },
          { e:"üôà", m:"No?? I didn‚Äôt hear that üôàüíó" }
        ],
        maybe: [
          { e:"üòä", m:"Your move üòåüíó" },
          { e:"üòå", m:"Take your time‚Ä¶ but choose wisely üòå‚ú®" },
          { e:"ü´∂", m:"I‚Äôm right here ü´∂üíû" },
          { e:"ü§ç", m:"Softly waiting‚Ä¶ ü§çüåô" },
          { e:"üòá", m:"I‚Äôll be good‚Ä¶ promise üòáüíó" }
        ],
        boost: [
          { e:"‚ú®", m:"Ooo bonus love! üíó" },
          { e:"üòö", m:"That was adorable üòöüíû" },
          { e:"ü•∞", m:"You caught it! More love incoming ü•∞" }
        ]
      };

      const pool = moods[kind] || moods.maybe;
      const p = pool[(Math.random() * pool.length) | 0];

      valEmoji.textContent = p.e;
      valMood.textContent = text || p.m;

      gsap.killTweensOf([valEmoji, valMood]);

      gsap.fromTo(valEmoji,
        { scale: 0.92, rotation: -2 },
        { scale: 1.08, rotation: 2, duration: 0.18, ease:"power2.out", yoyo:true, repeat:1 }
      );

      gsap.fromTo(valMood,
        { opacity: 0, y: 6 },
        { opacity: 1, y: 0, duration: 0.22, ease:"power2.out" }
      );

      if(kind === "yes"){
        gsap.fromTo(valEmoji, { filter:"drop-shadow(0 0 0 rgba(240,143,177,0))" },
          { filter:"drop-shadow(0 0 18px rgba(240,143,177,.55))", duration: 0.22, yoyo:true, repeat:1, ease:"power2.out" }
        );
      } else if(kind === "no"){
        gsap.fromTo(valEmoji, { x: 0 },
          { x: 6, duration: 0.06, yoyo:true, repeat: 5, ease:"power1.inOut" }
        );
      }
    }

    function setCharge(p){
      charge = Math.max(0, Math.min(100, p));
      wave.style.height = `${charge}%`;
      wave.style.transform = `translateY(${8 - (charge*0.08)}px)`;
      chargePct.textContent = `${Math.round(charge)}%`;

      if(charge < 20) yesText.textContent = "Hold to say YES üíò";
      else if(charge < 55) yesText.textContent = "Ooo it‚Äôs filling‚Ä¶ üåä";
      else if(charge < 90) yesText.textContent = "Almost there‚Ä¶ ü•πüíó";
      else yesText.textContent = "Release to seal it üíû";

      if(charge >= 100){
        yesBtn.classList.add("charged");
        yesText.textContent = "YES locked üíó";
        acceptYes(); // auto accept when full
      } else {
        yesBtn.classList.remove("charged");
      }
    }

    // Bubble system
    let bubbleTimer = null;
    function spawnBubble(intensity=1){
      if(charge <= 2) return;
      const b = document.createElement("span");
      b.className = "bubble";
      const w = yesBtn.clientWidth;
      const x = 12 + Math.random()*(w-24);
      const s = 3 + Math.random()*7;
      b.style.width = s + "px";
      b.style.height = s + "px";
      b.style.left = x + "px";
      b.style.bottom = (6 + Math.random()*10) + "px";
      wave.appendChild(b);

      const rise = 14 + Math.random()*22 + intensity*8;
      const drift = -10 + Math.random()*20;
      gsap.fromTo(b,
        { opacity: 0, y: 0, x: 0, scale: 0.8 },
        { opacity: 0.8, duration: 0.10, ease:"power2.out", onComplete: () => {
          gsap.to(b, {
            y: -rise,
            x: drift,
            opacity: 0,
            scale: 1.15,
            duration: 0.65 + Math.random()*0.4,
            ease:"power1.out",
            onComplete: () => b.remove()
          });
        }}
      );

      // occasional bubble pop sound (soft)
      if(Math.random() < 0.35) SFX.bubble();
    }

    function startBubbles(){
      if(bubbleTimer) return;
      bubbleTimer = setInterval(() => {
        if(!charging) return;
        const intensity = 1 + Math.min(2.2, (noClicks*0.03) + loveBoost);
        // spawn 1-2 bubbles
        spawnBubble(intensity);
        if(Math.random() < 0.35) spawnBubble(intensity);
      }, 180);
    }

    function stopBubbles(){
      if(!bubbleTimer) return;
      clearInterval(bubbleTimer);
      bubbleTimer = null;
    }

    function startCharging(){
      if(charging) return;
      if(yesBtn.dataset.done === "1") return;

      charging = true;
      lastTs = 0;
      startBubbles();
      SFX.charge();

      gsap.fromTo(yesBtn, {scale:0.99}, {scale:1.02, duration:0.18, ease:"power2.out", yoyo:true, repeat:1});

      const speed = 22; // % per second
      const tick = (ts) => {
        if(!charging) return;
        if(!lastTs) lastTs = ts;
        const dt = (ts - lastTs) / 1000;
        lastTs = ts;

        // More NO interactions => faster YES fill
        const boostFactor = 1 + Math.min(1.2, (noClicks * 0.05) + loveBoost);
        setCharge(charge + speed * dt * boostFactor);

        // add tiny slosh based on charging
        setSlosh((Math.sin(ts/240) * 0.18), (Math.cos(ts/300) * 0.12));

        if(charge < 100) chargeRaf = requestAnimationFrame(tick);
      };

      chargeRaf = requestAnimationFrame(tick);
    }

    function stopCharging(){
      charging = false;
      if(chargeRaf) cancelAnimationFrame(chargeRaf);
      chargeRaf = null;
      stopBubbles();

      if(charge < 100){
        gsap.to({p: charge}, {
          p: Math.max(0, charge - 10),
          duration: 0.35,
          ease: "power2.out",
          onUpdate: function(){ setCharge(this.targets()[0].p); }
        });
      }
    }

    function thanosDustFrom(element){
      const ar = arena.getBoundingClientRect();
      const r  = element.getBoundingClientRect();

      const left = r.left - ar.left;
      const top  = r.top  - ar.top;
      const w = r.width, h = r.height;

      const count = Math.max(120, Math.min(260, Math.floor((w*h)/140)));
      const colors = [
        "rgba(181,22,82,.60)",
        "rgba(240,143,177,.60)",
        "rgba(43,15,29,.22)",
        "rgba(255,255,255,.38)",
        "rgba(255,224,235,.48)"
      ];

      for(let s=0;s<10;s++){
        const sp = document.createElement("span");
        sp.className = "spark";
        const sx = left + Math.random()*w;
        const sy = top  + Math.random()*h;
        sp.style.left = sx + "px";
        sp.style.top  = sy + "px";
        dustLayer.appendChild(sp);

        gsap.fromTo(sp,
          { opacity: 0, scale: 0.6 },
          {
            opacity: 1,
            scale: 1.8,
            duration: 0.12,
            ease: "power2.out",
            yoyo: true,
            repeat: 1,
            onComplete: () => sp.remove()
          }
        );
      }

      for(let i=0;i<count;i++){
        const p = document.createElement("span");
        p.className = "dust";

        const size = 1.6 + Math.random()*7.2;
        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.background = colors[(Math.random()*colors.length)|0];

        const shape = Math.random();
        if(shape < 0.22){
          p.style.borderRadius = "3px";
        } else if(shape < 0.38){
          p.style.borderRadius = "10px 2px 10px 2px";
        }

        const x = left + Math.random()*w;
        const y = top  + Math.random()*h;
        p.style.left = x + "px";
        p.style.top  = y + "px";

        dustLayer.appendChild(p);

        const driftX = 120 + Math.random()*260;
        const driftY = -110 + Math.random()*220;
        const rot = -120 + Math.random()*240;

        gsap.fromTo(p,
          { opacity: 0, x: 0, y: 0, scale: 1, filter: "blur(0px)" },
          {
            opacity: 1,
            duration: 0.03,
            ease: "power1.out",
            onComplete: () => {
              gsap.to(p, {
                x: driftX,
                y: driftY,
                rotation: rot,
                scale: 0.10 + Math.random()*0.95,
                opacity: 0,
                filter: "blur(2.6px)",
                duration: 0.55 + Math.random()*0.95,
                ease: "power2.out",
                onComplete: () => p.remove()
              });
            }
          }
        );
      }
    }

    function noClickSequence(reason){
      if(noBusy) return;
      noBusy = true;

      setValMood("no", `Excuse: ${reason}`);
      noBtn.textContent = reason;

      SFX.boop();

      // make it feel interactive
      gsap.fromTo(valEmoji, { rotation: -3 }, { rotation: 3, duration: 0.08, yoyo: true, repeat: 5, ease:"power1.inOut" });

      setTimeout(() => {
        thanosDustFrom(noBtn);
        SFX.snap();

        gsap.to(noWrap, {
          opacity: 0,
          scale: 0.82,
          filter: "blur(3px)",
          duration: 0.28,
          ease: "power2.in"
        });

        setTimeout(() => {
          moveNoTo(randomSpot(), true);
          noBtn.textContent = "No üôà";
          setValMood("maybe", pick(["Try YES üòåüíó","Still no? üôà","I‚Äôm waiting‚Ä¶ ü•∫","Okay okay‚Ä¶ your move üíû"]));

          gsap.fromTo(noWrap,
            { opacity: 0, scale: 0.92, filter:"blur(0px)" },
            { opacity: 1, scale: 1, duration: 0.26, ease: "power2.out" }
          );

          noBusy = false;
        }, 320);
      }, 900);
    }

    // NO click => boosts YES charge (the more they play, the faster it fills)
    noBtn.addEventListener("click", () => {
      const reason = pick(REASONS);
      noClickSequence(reason);

      noClicks++;

      // instant cute bump to YES fill
      if(charge < 100){
        setCharge(charge + 7 + Math.min(10, noClicks * 0.4));
        gsap.fromTo(wave, {filter:"brightness(1)"}, {filter:"brightness(1.12)", duration:0.12, yoyo:true, repeat:1});
        gsap.fromTo(yesBtn, {scale:0.995}, {scale:1.02, duration:0.16, yoyo:true, repeat:1, ease:"power2.out"});
      }

      // temporary boost that decays
      loveBoost = Math.min(1.0, loveBoost + 0.12);

      if(boostDecayTimer) clearInterval(boostDecayTimer);
      boostDecayTimer = setInterval(() => {
        loveBoost = Math.max(0, loveBoost - 0.04);
        if(loveBoost <= 0){
          clearInterval(boostDecayTimer);
          boostDecayTimer = null;
        }
      }, 140);
    });

    // Catch-the-heart => big boost + sparkle + move
    catchHeart.addEventListener("click", () => {
      SFX.sparkle();
      setValMood("boost", pick(["Caught! üíó +love boost!", "Nice! That was adorable ü•∞", "Okayyy you‚Äôre good üòöüíû"]));

      if(charge < 100){
        setCharge(charge + 10 + Math.min(16, noClicks*0.5));
      }
      // micro confetti puff
      confetti({ particleCount: 18, spread: 45, startVelocity: 18, scalar: 0.7, origin: { y: 0.72 } });

      // bubble burst (visual)
      for(let i=0;i<5;i++) spawnBubble(2.4);

      gsap.fromTo(catchHeart, {scale:0.96}, {scale:1.12, duration:0.16, yoyo:true, repeat:1, ease:"power2.out"});
      moveCatchHeart(false);
    });

    function acceptYes(){
      if(yesBtn.dataset.done === "1") return;
      yesBtn.dataset.done = "1";
      charging = false;
      if(chargeRaf) cancelAnimationFrame(chargeRaf);
      stopBubbles();

      setValMood("yes", "Yesss‚Ä¶ you just made my whole heart blush üíó");
      SFX.win();

      confetti({ particleCount: 170, spread: 75, startVelocity: 32, scalar: 0.95, origin: { y: 0.6 } });
      setTimeout(() => confetti({ particleCount: 120, spread: 110, startVelocity: 26, scalar: 0.85, origin: { y: 0.55 } }), 160);

      const day = state.metDay ?? "";
      document.getElementById("finalLine1").textContent = `You have won my heart, ${CUTIE_NAME}.`;
      document.getElementById("finalLine2").textContent =
        day ? `And I‚Äôll never forget ${MONTH_NAME} ${day}, ${YEAR}. üíó` : `Happy Valentine‚Äôs Day ‚ú®`;

      renderCheesyCards();
      setTimeout(() => showScreen("s4"), 520);
    }

    // Hold interactions for YES
    yesBtn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      if(yesBtn.dataset.done === "1") return;
      startCharging();
    });

    yesBtn.addEventListener("pointerup", (e) => {
      e.preventDefault();
      if(yesBtn.dataset.done === "1") return;
      stopCharging();
    });

    yesBtn.addEventListener("pointercancel", stopCharging);
    yesBtn.addEventListener("pointerleave", () => { if(charging) stopCharging(); });

    // Disable normal click (so can't instantly yes)
    yesBtn.addEventListener("click", (e) => { e.preventDefault(); });

    function placeNoInitial(){
      moveNoTo(randomSpot(), true);
      moveCatchHeart(true);

      noBtn.textContent = "No üôà";
      noBusy = false;
      valEmoji.textContent = "üòä";
      valMood.textContent = "Be honest‚Ä¶ but be gentle üòå";

      yesBtn.dataset.done = "0";
      setCharge(0);
      noClicks = 0;
      loveBoost = 0;
      setSlosh(0,0);
    }

    // =======================
    // SCREEN 4: Final
    // =======================
    const cheesyGrid = document.getElementById("cheesyGrid");
    const heartLayer = document.getElementById("heartLayer");
    let finalHeartsTimer = null;

    function renderCheesyCards(){
      const cards = [
        { icon:"üëª", title:"Ghost Hug", text:"You can‚Äôt see it‚Ä¶ but it‚Äôs always there." },
        { icon:"ü´Ç", title:"Hugs Speak", text:"Hugs speak louder than words. Always." },
        { icon:"üåç", title:"Wherever You Are", text:"No distance can change this: I love you." },
        { icon:"üìà", title:"My Love Graph", text:"It‚Äôs increasing‚Ä¶ day by day. (No limit üòå)" },
        { icon:"üìê", title:"If you were an angle‚Ä¶", text:"You‚Äôd be A-CUTE-ONE üíó" },
        { icon:"üìù", title:"Thank You", text:"For being you. For existing. For making me smile." },
      ];

      cheesyGrid.innerHTML = cards.map(c => `
        <div class="noteCard">
          <div class="noteIcon">${c.icon}</div>
          <div class="noteTitle">${c.title}</div>
          <div class="noteText">${c.text}</div>
        </div>
      `).join("");
    }

    function spawnFloatingHeart(){
      const hearts = ["üíó","üíû","üíò","üíï","üíì"];
      const el = document.createElement("div");
      el.className = "floatHeart";
      el.textContent = pick(hearts);

      const w = heartLayer.clientWidth;
      const h = heartLayer.clientHeight;

      const x = 12 + Math.random()*(w - 24);
      const startY = h + 10;
      const endY = -40 - Math.random()*60;

      el.style.left = x + "px";
      el.style.top = startY + "px";
      el.style.fontSize = (14 + Math.random()*12) + "px";
      heartLayer.appendChild(el);

      const driftX = -30 + Math.random()*60;
      const rot = -18 + Math.random()*36;

      gsap.fromTo(el,
        { opacity: 0, y: 0, x: 0, rotation: 0, scale: 0.9 },
        { opacity: 0.85, duration: 0.18, ease: "power2.out",
          onComplete: () => {
            gsap.to(el, {
              y: endY - startY,
              x: driftX,
              rotation: rot,
              opacity: 0,
              scale: 1.15,
              duration: 2.8 + Math.random()*1.6,
              ease: "power1.out",
              onComplete: () => el.remove()
            });
          }
        }
      );
    }

    function startFinalEffects(){
      SFX.win();
      confetti({ particleCount: 120, spread: 80, startVelocity: 28, scalar: 0.95, origin: { y: 0.55 } });
      setTimeout(() => confetti({ particleCount: 90, spread: 120, startVelocity: 22, scalar: 0.8, origin: { y: 0.5 } }), 180);

      heartLayer.innerHTML = "";
      if(finalHeartsTimer) clearInterval(finalHeartsTimer);
      finalHeartsTimer = setInterval(spawnFloatingHeart, 220);

      setTimeout(() => {
        if(finalHeartsTimer) clearInterval(finalHeartsTimer);
        finalHeartsTimer = null;
      }, 9000);
    }

    // =======================
    // Navigation
    // =======================
    toS3.addEventListener("click", async () => {
      SFX.sparkle();

      const valSub = document.getElementById("valSub");
      const day = state.metDay ?? "that day";
      valSub.innerHTML = `Since <span class="name">${MONTH_NAME} ${day}, ${YEAR}</span>, I‚Äôve been smiling more.`;

      showScreen("s3");
      placeNoInitial();

      // enable motion (iOS permission)
      try{
        if (typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function") {
          const res = await DeviceMotionEvent.requestPermission();
          if(res === "granted") enableMotion();
        } else {
          enableMotion();
        }
      }catch(e){
        enableMotion();
      }
    });

    document.getElementById("replay").addEventListener("click", () => {
      SFX.wrong();
      state.metDay = null;
      state.tttWon = false;

      toS2.disabled = true;
      dateNote.textContent = "Choose our day‚Ä¶";
      document.querySelectorAll(".dateBtn").forEach(x => x.classList.remove("selected"));

      initTTT();
      showScreen("s1");
    });

    window.addEventListener("resize", () => {
      if(document.getElementById("s3").classList.contains("active")){
        placeNoInitial();
      }
    });

    // Start screen 2 from screen 1
    toS2.addEventListener("click", () => { /* already handled above */ });

    // Initialize
    initTTT();

    // Screen 1 next enabled after date select
    // (already in selectDay)

    // When moving to screen 2 directly from screen 1 next:
    // (handled in toS2 click above)

  </script>
</body>
</html>
