<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>üíó A Little Love Game</title>

  <!-- Premium fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#e8b7c6;
      --bg2:#f0d0da;
      --bg3:#fbf2f5;

      --paper: rgba(255, 252, 253, .84);
      --stroke: rgba(255,255,255,.62);
      --shadow: 0 24px 84px rgba(36, 10, 20, .14);

      --ink:#2b0f1d;
      --muted: rgba(43,15,29,.72);

      --accent1:#b51652;
      --accent2:#f08fb1;

      --radius: 28px;
      --btnShadow: 0 18px 40px rgba(181, 22, 82, .16);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      background:
        radial-gradient(900px 650px at 15% 15%, var(--bg3) 0%, transparent 58%),
        radial-gradient(900px 650px at 85% 20%, #ffe4ea 0%, transparent 60%),
        linear-gradient(125deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-tap-highlight-color: transparent;
    }

    .noise{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.055;
      mix-blend-mode: soft-light;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.30'/%3E%3C/svg%3E");
    }

    .wrap{
      min-height: 100svh;
      display:grid;
      place-items:center;
      padding: max(14px, env(safe-area-inset-top)) 14px max(18px, env(safe-area-inset-bottom));
    }

    .card{
      width: min(920px, 100%);
      border-radius: var(--radius);
      background: var(--paper);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      padding: clamp(16px, 4.2vw, 30px);
      position:relative;
      overflow:hidden;
    }

    .shine{
      position:absolute; inset:-170px -200px auto auto;
      width:420px; height:420px;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.72), rgba(255,255,255,0) 62%);
      transform: rotate(18deg);
      opacity:.85;
      pointer-events:none;
    }

    /* Small sound toggle */
    .audioFab{
      position: fixed;
      top: 10px;
      right: 10px;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid rgba(43,15,29,.12);
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 26px rgba(36,10,20,.10);
      cursor:pointer;
      z-index: 999;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .audioFab::before{ content:"üîä"; font-size: 16px; }
    .audioFab.off::before{ content:"üîá"; }

    .screens{ position: relative; min-height: 72svh; }
    .screen{ display:none; animation: fadeIn .25s ease-out; }
    .screen.active{ display:block; }

    @keyframes fadeIn{
      from{ opacity: 0; transform: translateY(8px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    h1,h2{
      margin:0;
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight:800;
      letter-spacing:.15px;
      line-height: 1.12;
      color: #240a14;
    }
    h1{ font-size: clamp(22px, 6.2vw, 44px); }
    h2{ font-size: clamp(20px, 6vw, 40px); }

    .sub{
      margin: 10px 0 0;
      text-align:center;
      font-size: clamp(12px, 3.6vw, 15px);
      color: var(--muted);
    }
    .name{ color: var(--accent1); }

    .divider{
      display:flex; align-items:center; justify-content:center;
      gap:12px;
      opacity:.85;
      margin: 12px 0 14px;
      font-size: 14px;
      user-select:none;
    }
    .divider::before, .divider::after{
      content:"";
      height:1px;
      width:min(220px, 24vw);
      background: linear-gradient(90deg, transparent, rgba(181,22,82,.25), transparent);
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    .btn{
      border:0;
      border-radius: 999px;
      padding: 12px 18px;
      font-family: Inter, system-ui;
      font-weight: 900;
      font-size: clamp(14px, 4.2vw, 18px);
      letter-spacing:.2px;
      user-select:none;
      cursor:pointer;
      touch-action: manipulation;
    }
    .btn.primary{
      color:#fff;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: var(--btnShadow);
      position:relative;
      overflow:hidden;
    }
    .btn.primary::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.38) 42%, transparent 70%);
      transform: translateX(-130%) skewX(-18deg);
      animation: sweep 3.2s ease-in-out infinite;
      opacity:.55;
      pointer-events:none;
    }
    @keyframes sweep{
      0%{ transform: translateX(-130%) skewX(-18deg); }
      45%{ transform: translateX(150%) skewX(-18deg); }
      100%{ transform: translateX(150%) skewX(-18deg); }
    }
    .btn.primary:disabled{
      opacity:.45;
      cursor:not-allowed;
      filter: grayscale(.1);
    }
    .btn.ghost{
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(43,15,29,.12);
      color: rgba(43,15,29,.86);
      box-shadow: 0 10px 24px rgba(36,10,20,.08);
    }

    /* ===== Screen 1: Calendar ===== */
    .paperBlock{
      margin-top: 14px;
      border-radius: 22px;
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      padding: 14px;
    }
    .monthTitle{
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: clamp(18px, 5.2vw, 30px);
      color: rgba(43,15,29,.88);
      margin: 4px 0 8px;
    }
    .dowRow{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 8px;
      opacity:.80;
      padding-inline: 2px;
    }
    .dow{
      text-align:center;
      font-weight: 900;
      font-size: 12px;
      color: rgba(43,15,29,.78);
      user-select:none;
    }
    .calendarGrid{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 8px;
      align-items: center;
      justify-items: center;
      padding-inline: 2px;
    }
    .dateBtn{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border: 1px solid rgba(43,15,29,.08);
      background: rgba(255,255,255,.85);
      color: rgba(43,15,29,.88);
      font-weight: 900;
      font-size: clamp(12px, 3.6vw, 14px);
      display:grid;
      place-items:center;
      position:relative;
      cursor:pointer;
      user-select:none;
    }
    .blank{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border: 1px dashed rgba(43,15,29,.06);
      background: rgba(255,255,255,.25);
    }
    .dateBtn.selected{
      border-color: rgba(181,22,82,.30);
      box-shadow: 0 14px 30px rgba(181,22,82,.12);
      transform: translateY(-1px);
    }
    .dateBtn.selected::after{
      content:"üíó";
      position:absolute;
      bottom: -7px;
      right: -2px;
      font-size: 14px;
      filter: drop-shadow(0 8px 12px rgba(181,22,82,.12));
    }
    .dateBtn.suggest{
      border-color: rgba(181,22,82,.25);
      box-shadow: 0 18px 38px rgba(181,22,82,.18);
    }
    .dateBtn.suggest::before{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius: 18px;
      background: conic-gradient(
        from 180deg,
        rgba(181,22,82,0),
        rgba(181,22,82,.45),
        rgba(240,143,177,.55),
        rgba(181,22,82,.45),
        rgba(181,22,82,0)
      );
      filter: blur(6px);
      opacity:.8;
      animation: ringGlow 1.1s ease-in-out infinite;
      z-index:-1;
    }
    @keyframes ringGlow{
      0%,100%{ transform: scale(.98); opacity:.55; }
      50%{ transform: scale(1.03); opacity:.90; }
    }
    .noteLine{
      margin-top: 10px;
      text-align:center;
      font-weight: 800;
      color: rgba(43,15,29,.78);
      font-size: clamp(12px, 3.6vw, 15px);
      min-height: 1.7em;
      user-select:none;
    }

    /* ===== Screen 2: TicTacToe ===== */
    .tttWrap{ margin-top: 12px; display:grid; gap: 10px; }
    .tttTopWin{
      text-align:center;
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: clamp(16px, 4.8vw, 22px);
      color: rgba(43,15,29,.92);
      margin-top: 6px;
      min-height: 1.6em;
      user-select:none;
    }
    .tttTopWin.glow{
      text-shadow:
        0 0 16px rgba(181,22,82,.35),
        0 0 36px rgba(240,143,177,.35);
      animation: topGlow 1.1s ease-in-out infinite;
    }
    @keyframes topGlow{
      0%,100%{ opacity:.85; transform: translateY(0); }
      50%{ opacity:1; transform: translateY(-1px); }
    }
    .tttBoardShell{
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      position:relative;
      padding: 0 18px; /* prevents cut on phone */
    }
    .tttBoard{
      width: 100%;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(8px, 2.2vw, 10px);
      padding: clamp(10px, 2.6vw, 12px);
      border-radius: 22px;
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      overflow: hidden;
    }
    .cell{
      aspect-ratio: 1/1;
      border-radius: clamp(14px, 3.2vw, 18px);
      border: 1px solid rgba(43,15,29,.10);
      background: rgba(255,255,255,.90);
      font-weight: 900;
      font-size: clamp(22px, 7vw, 34px);
      font-family:"Playfair Display", serif;
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      position:relative;
      overflow:hidden;
    }
    .cell.pop{ animation: popIn .22s ease-out; }
    @keyframes popIn{
      from{ transform: scale(.78); opacity:.2; }
      to{ transform: scale(1); opacity:1; }
    }
    .cell.hint::after{
      content:"";
      position:absolute; inset: 10px;
      border-radius: 14px;
      border: 2px dashed rgba(181,22,82,.32);
      animation: pulse 1.1s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes pulse{
      0%,100%{ opacity:.35; transform: scale(.98); }
      50%{ opacity:.75; transform: scale(1.02); }
    }
    .tttStatus{
      text-align:center;
      font-weight: 900;
      font-size: clamp(13px, 3.8vw, 16px);
      color: rgba(43,15,29,.82);
      min-height: 1.6em;
      user-select:none;
    }
    .winSvg{
      position:absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events:none;
    }

    /* ===== Screen 3: Catch Hearts Game ===== */
    .emojiRow{
      display:grid;
      place-items:center;
      gap: 8px;
      margin-top: 12px;
      user-select:none;
    }
    .emoji{
      font-size: clamp(52px, 15vw, 92px);
      line-height: 1;
      will-change: transform;
      user-select:none;
    }
    .mood{
      text-align:center;
      font-weight: 900;
      font-size: clamp(13px, 3.9vw, 16px);
      color: rgba(43,15,29,.84);
      min-height: 2.0em;
      padding: 0 8px;
      user-select:none;
    }

    .arena{
      margin-top: 10px;
      position:relative;
      height: clamp(420px, 60vh, 640px);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.55);
      background: rgba(255,255,255,.38);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      overflow:hidden;
      padding: 12px;
      user-select:none;
      touch-action: none;
    }

    /* HUD */
    .catchHud{
      position:absolute;
      left: 12px;
      right: 12px;
      top: 8px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      z-index: 10;
      pointer-events:none;
      user-select:none;
    }
    .hudPill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 14px 38px rgba(36,10,20,.08);
      font-weight: 900;
      color: rgba(43,15,29,.86);
      font-size: 12px;
      white-space: nowrap;
    }

    /* Field for falling items (extra bottom space so YES never overlaps) */
    .catchField{
      position:absolute;
      inset: 56px 10px 96px 10px; /* TOP, RIGHT, BOTTOM, LEFT */
      border-radius: 18px;
      overflow:hidden;
      z-index: 2;
      background: radial-gradient(220px 160px at 30% 10%, rgba(240,143,177,.14), transparent 60%);
      border: 1px solid rgba(255,255,255,.42);
    }
    @media (max-width:430px){
      .catchField{ inset: 54px 8px 96px 8px; }
    }

    .catchHint{
      position:absolute;
      left: 50%;
      top: 64px;
      transform: translateX(-50%);
      z-index: 9;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(43,15,29,.08);
      font-weight: 900;
      font-size: 12px;
      color: rgba(43,15,29,.78);
      user-select:none;
      pointer-events:none;
      text-align:center;
      max-width: 92%;
    }

    /* Basket */
    .basket{
      position:absolute;
      left: 50%;
      bottom: 80px; /* sits above YES button area */
      transform: translateX(-50%);
      width: min(220px, 70%);
      height: 48px;
      border-radius: 999px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 18px 44px rgba(36,10,20,.08), inset 0 1px 0 rgba(255,255,255,.5);
      z-index: 6;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      user-select:none;
    }
    .basket::before{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 50%, rgba(240,143,177,.22), transparent 60%);
      filter: blur(8px);
      opacity:.6;
      z-index:-1;
    }
    .basketLabel{
      font-weight: 900;
      color: rgba(43,15,29,.84);
      font-size: 13px;
      user-select:none;
    }
    .basketGrip{
      opacity:.8;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.10));
      user-select:none;
    }

    /* Falling items */
    .drop{
      position:absolute;
      top: -60px;
      will-change: transform;
      user-select:none;
      pointer-events:none;
      filter: drop-shadow(0 14px 18px rgba(181,22,82,.10));
    }
    .drop.heart{ font-size: 26px; }
    .drop.bomb{ font-size: 22px; filter: drop-shadow(0 14px 18px rgba(0,0,0,.12)); }

    /* Toast (message on catch) */
    .toast{
      position:absolute;
      left: 50%;
      bottom: 145px;
      transform: translateX(-50%);
      z-index: 11;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.76);
      border: 1px solid rgba(43,15,29,.10);
      box-shadow: 0 16px 40px rgba(36,10,20,.10);
      font-weight: 900;
      font-size: 12.5px;
      color: rgba(43,15,29,.86);
      opacity: 0;
      pointer-events:none;
      user-select:none;
      max-width: 92%;
      text-align:center;
    }
    .dust{
      position:absolute;
      inset:0;
      pointer-events:none;
      border-radius: 999px;
      overflow:hidden;
    }
    .dust i{
      position:absolute;
      width: 6px; height: 6px;
      border-radius: 999px;
      background: rgba(181,22,82,.35);
      opacity: 0;
    }

    /* YES hold button pinned at bottom */
    .chargeBtn{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      height: 52px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      overflow:hidden;
      touch-action: none;
      user-select:none;
      -webkit-user-select:none;
      z-index: 12; /* above field + drops */
      width: min(520px, 92%);
    }
    .premiumYes{
      border: 1px solid rgba(255,255,255,.42);
      background: radial-gradient(120px 70px at 30% 20%, rgba(255,255,255,.28), transparent 60%),
                  linear-gradient(135deg, rgba(181,22,82,.92), rgba(240,143,177,.92));
      box-shadow: 0 20px 46px rgba(181,22,82,.16), inset 0 1px 0 rgba(255,255,255,.35);
    }
    .chargeBtn .yesText{ position:relative; z-index: 6; }
    .chargeBtn .chargePct{ position:relative; z-index: 6; font-weight: 900; opacity: .95; }

    /* water layer */
    .chargeBtn .wave{
      position:absolute;
      left:0; bottom:0;
      width:100%;
      height:0%;
      z-index:1;
      opacity:.96;
      border-radius: 999px;
      background:
        radial-gradient(18px 12px at 18% 24%, rgba(255,255,255,.35), transparent 65%),
        radial-gradient(22px 16px at 70% 35%, rgba(255,255,255,.22), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.05)),
        linear-gradient(135deg, rgba(181,22,82,.95), rgba(240,143,177,.95));
      transform: translateY(8px);
      box-shadow: inset 0 8px 18px rgba(255,255,255,.10);
      overflow:hidden;
    }
    /* wavy sheen (no device orientation permission) */
    .chargeBtn .wave::after{
      content:"";
      position:absolute;
      left:-40%;
      top: 8px;
      width:180%;
      height:18px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.26), transparent);
      filter: blur(1px);
      opacity:.85;
      animation: waveSweep 1.25s ease-in-out infinite;
    }
    @keyframes waveSweep{
      0%{ transform: translateX(-20%); }
      50%{ transform: translateX(20%); }
      100%{ transform: translateX(-20%); }
    }

    /* fizz bubbles */
    .fizz{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:2;
      border-radius: 999px;
      overflow:hidden;
    }
    .fizzBubble{
      position:absolute;
      bottom:-10px;
      border-radius: 999px;
      background: rgba(255,255,255,.62);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
      opacity: 0;
    }

    .hint{
      text-align:center;
      font-size: 12.5px;
      color: rgba(43,15,29,.66);
      margin-top: 10px;
      user-select:none;
    }

    /* ===== Screen 4: Final ===== */
    .finalWrap{ position: relative; margin-top: 14px; }
    .finalBox{
      border-radius: 22px;
      background: rgba(255,255,255,.46);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      padding: 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
      isolation: isolate;
    }
    .finalBox::before{
      content:"";
      position:absolute;
      inset:-60px;
      background: radial-gradient(circle at 30% 20%, rgba(240,143,177,.28), transparent 62%),
                  radial-gradient(circle at 70% 20%, rgba(181,22,82,.20), transparent 60%),
                  radial-gradient(circle at 50% 90%, rgba(255,255,255,.30), transparent 60%);
      filter: blur(10px);
      opacity:.95;
      z-index: -1;
      animation: finalGlow 3.8s ease-in-out infinite;
    }
    @keyframes finalGlow{
      0%,100%{ transform: translateY(0) scale(1); opacity:.85; }
      50%{ transform: translateY(-6px) scale(1.02); opacity:1; }
    }
    .finalBox::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.22) 38%, transparent 70%);
      transform: translateX(-140%) skewX(-18deg);
      animation: finalSweep 4.2s ease-in-out infinite;
      pointer-events:none;
      z-index: 0;
    }
    @keyframes finalSweep{
      0%{ transform: translateX(-140%) skewX(-18deg); }
      45%{ transform: translateX(160%) skewX(-18deg); }
      100%{ transform: translateX(160%) skewX(-18deg); }
    }
    .finalEmoji{
      font-size: clamp(68px, 18vw, 110px);
      line-height:1;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
      filter: drop-shadow(0 18px 22px rgba(181,22,82,.12));
      animation: heartbeat 1.6s ease-in-out infinite;
      user-select:none;
    }
    @keyframes heartbeat{
      0%,100%{ transform: scale(1); }
      18%{ transform: scale(1.08); }
      36%{ transform: scale(1.0); }
      55%{ transform: scale(1.06); }
      72%{ transform: scale(1.0); }
    }
    .finalLine{
      font-weight: 900;
      color: rgba(43,15,29,.82);
      font-size: clamp(13px, 3.9vw, 16px);
      position: relative;
      z-index: 1;
      user-select:none;
    }
    .finalLine.glowy{
      text-shadow:
        0 0 16px rgba(181,22,82,.20),
        0 0 34px rgba(240,143,177,.18);
      animation: textGlow 2.2s ease-in-out infinite;
    }
    @keyframes textGlow{
      0%,100%{ opacity:.92; transform: translateY(0); }
      50%{ opacity:1; transform: translateY(-1px); }
    }

    .cheesyGrid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 720px){
      .cheesyGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .noteCard{
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(43,15,29,.08);
      box-shadow: 0 14px 38px rgba(36,10,20,.08);
      padding: 12px 12px 10px;
      position:relative;
      overflow:hidden;
      animation: cardFloat 4.2s ease-in-out infinite;
      user-select:none;
    }
    .noteCard:nth-child(2){ animation-delay: .4s; }
    .noteCard:nth-child(3){ animation-delay: .8s; }
    .noteCard:nth-child(4){ animation-delay: 1.2s; }
    .noteCard:nth-child(5){ animation-delay: 1.6s; }
    .noteCard:nth-child(6){ animation-delay: 2.0s; }
    @keyframes cardFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
    }
    .noteCard::after{
      content:"";
      position:absolute;
      inset: 0;
      background: radial-gradient(220px 140px at 30% 10%, rgba(240,143,177,.18), transparent 60%);
      pointer-events:none;
    }
    .noteTitle{
      font-family:"Playfair Display", serif;
      font-weight: 800;
      font-size: 14px;
      color: rgba(43,15,29,.92);
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }
    .noteText{
      font-weight: 800;
      font-size: 12.5px;
      color: rgba(43,15,29,.76);
      line-height: 1.25;
      position: relative;
      z-index: 1;
    }
    .noteIcon{
      position:absolute;
      right: 10px;
      top: 10px;
      opacity:.95;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.10));
      animation: iconGlow 2.8s ease-in-out infinite;
      z-index: 1;
    }
    @keyframes iconGlow{
      0%,100%{ transform: scale(1); opacity:.92; }
      50%{ transform: scale(1.06); opacity:1; }
    }

    .heartLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 2;
      border-radius: 22px;
    }
    .floatHeart{
      position:absolute;
      opacity: 0;
      filter: drop-shadow(0 10px 14px rgba(181,22,82,.10));
      will-change: transform, opacity;
      user-select:none;
    }
  </style>
</head>

<body>
  <div class="noise"></div>
  <button class="audioFab" id="audioToggle" aria-label="Toggle sound" title="Sound"></button>

  <div class="wrap">
    <div class="card">
      <div class="shine"></div>

      <div class="screens">

        <!-- SCREEN 1 -->
        <section class="screen active" id="s1">
          <h1>Let‚Äôs start with a memory ‚ú®</h1>
          <div class="divider">üíû</div>
          <p class="sub">Tap the date‚Ä¶ <b>when we met</b> üíó</p>

          <div class="paperBlock">
            <div class="monthTitle" id="monthTitle">July 2022</div>
            <div class="dowRow" id="dowRow"></div>
            <div class="calendarGrid" id="calendarGrid"></div>
            <div class="noteLine" id="dateNote">Pick the right day to unlock ‚ÄúNext‚Äù üòå</div>
          </div>

          <div class="row">
            <button class="btn primary" id="toS2" disabled>Next ‚ûú</button>
          </div>
        </section>

        <!-- SCREEN 2 -->
        <section class="screen" id="s2">
          <h1>Mini game üéÆ</h1>
          <div class="divider">üíó</div>
          <p class="sub">Win this and you win‚Ä¶ something cute üòâ</p>

          <div class="tttTopWin" id="tttTopWin"></div>

          <div class="tttWrap">
            <div class="tttBoardShell">
              <svg class="winSvg" id="winSvg"></svg>
              <div class="tttBoard" id="tttBoard"></div>
            </div>
            <div class="tttStatus" id="tttStatus">Your turn üíó</div>
          </div>

          <div class="row">
            <button class="btn ghost" id="resetTTT">Restart</button>
            <button class="btn primary" id="toS3" disabled>Next ‚ûú</button>
          </div>
        </section>

        <!-- SCREEN 3 -->
        <section class="screen" id="s3">
          <h1>One more little game‚Ä¶</h1>
          <div class="divider">üíû</div>

          <h2 style="margin-top:6px;">
            Will you be my Valentine, <span class="name" id="cutieNameInline">CUTIE_NAME</span>? üíò
          </h2>

          <p class="sub" id="valSub">Catch hearts‚Ä¶ avoid bombs üòå</p>

          <div class="emojiRow">
            <div class="emoji" id="valEmoji">ü´∂</div>
            <div class="mood" id="valMood">Catch hearts to fill YES üíó</div>
          </div>

          <div class="arena" id="arena">
            <div class="catchHud">
              <div class="hudPill" id="hudScore">üíó Hearts: 0</div>
              <div class="hudPill" id="hudMiss">üôà Miss: 0</div>
              <div class="hudPill" id="hudCharge">üíò YES: 0%</div>
            </div>

            <div class="catchHint" id="catchHint">Drag the basket ‚Ä¢ Hearts fill YES ‚Ä¢ Bombs steal love üí£</div>

            <div class="catchField" id="catchField"></div>

            <div class="basket" id="basket">
              <span class="basketGrip">‚áÜ</span>
              <span class="basketLabel">Catch here</span>
              <span class="basketGrip">‚áÜ</span>
            </div>

            <div class="toast" id="toast">
              <span id="toastText">Cute üòåüíó</span>
              <span class="dust" id="dust"></span>
            </div>

            <!-- YES button pinned bottom -->
            <button class="btn primary chargeBtn premiumYes" id="yesBtn" type="button" aria-label="Hold to say yes">
              <span class="yesText" id="yesText">Hold to say YES üíò</span>
              <span class="chargePct" id="chargePct">0%</span>
              <span class="wave" id="wave">
                <span class="fizz" id="fizz"></span>
              </span>
            </button>
          </div>

          <div class="hint">Tip: hearts = faster YES ‚Ä¢ bombs = lose charge ‚Ä¢ hold YES anytime (but game makes it fun üòå)</div>
        </section>

        <!-- SCREEN 4 -->
        <section class="screen" id="s4">
          <h2>Yayyy!! üíû</h2>
          <div class="divider">üåπ</div>

          <div class="finalWrap">
            <div class="finalBox">
              <div class="heartLayer" id="heartLayer"></div>
              <div class="finalEmoji">üòç</div>
              <div class="finalLine glowy" id="finalLine1">You have won my heart.</div>
              <div class="finalLine glowy" id="finalLine2" style="margin-top:6px;">Happy Valentine‚Äôs Day ‚ú®</div>
            </div>

            <div class="cheesyGrid" id="cheesyGrid"></div>
          </div>

          <div class="row">
            <button class="btn ghost" id="replay">Play again ‚Üª</button>
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script>
    // =======================
    // CONFIG (edit these)
    // =======================
    var CUTIE_NAME = "CUTIE_NAME";

    // Date screen config
    var MONTH_NAME = "July";
    var YEAR = 2022;
    var DAYS_IN_MONTH = 31;

    // 0=Mon,1=Tue,2=Wed,3=Thu,4=Fri,5=Sat,6=Sun
    // User asked: start day Thursday
    var MONTH_START_DOW = 3;

    // Correct date (user asked: 16 July 2022)
    var CORRECT_DAY = 16;

    // Catch game config
    var FALL_SPEED_PX_PER_SEC = 240;   // base speed (configurable)
    var SPAWN_HEART_EVERY_MS = 620;    // how often hearts spawn
    var SPAWN_BOMB_CHANCE = 0.20;      // 20% of spawns are bombs (configurable)
    var HEART_VALUE = 9;              // charge +%
    var BOMB_PENALTY = 12;            // charge -%

    // =======================
    // WebAudio (no external files)
    // =======================
    var audioUI = { enabled: true, ctx: null, master: null, unlocked: false };
    var audioToggle = document.getElementById("audioToggle");

    function updateAudioUI(){ audioToggle.classList.toggle("off", !audioUI.enabled); }
    updateAudioUI();

    function ensureAudio(){
      if(!audioUI.enabled) return false;
      if(audioUI.ctx) return true;
      try{
        audioUI.ctx = new (window.AudioContext || window.webkitAudioContext)();
        audioUI.master = audioUI.ctx.createGain();
        audioUI.master.gain.value = 0.38;
        audioUI.master.connect(audioUI.ctx.destination);
        return true;
      }catch(e){ return false; }
    }

    function now(){ return audioUI.ctx ? audioUI.ctx.currentTime : 0; }

    function tone(freq, dur, type, gain, slide){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      var t0 = now();
      var o = audioUI.ctx.createOscillator();
      var g = audioUI.ctx.createGain();
      var f = Math.max(40, freq);

      o.type = type || "sine";
      o.frequency.setValueAtTime(f, t0);
      if(slide) o.frequency.exponentialRampToValueAtTime(Math.max(40, f+slide), t0 + dur);

      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(gain || 0.06, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

      o.connect(g); g.connect(audioUI.master);
      o.start(t0);
      o.stop(t0 + dur + 0.02);
    }

    function noiseBurst(dur, gain){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      var t0 = now();
      var bufferSize = Math.floor(audioUI.ctx.sampleRate * dur);
      var buffer = audioUI.ctx.createBuffer(1, bufferSize, audioUI.ctx.sampleRate);
      var data = buffer.getChannelData(0);
      for(var i=0;i<bufferSize;i++){
        data[i] = (Math.random()*2 - 1) * (1 - i/bufferSize);
      }
      var src = audioUI.ctx.createBufferSource();
      src.buffer = buffer;

      var filt = audioUI.ctx.createBiquadFilter();
      filt.type = "highpass";
      filt.frequency.value = 1200;

      var g = audioUI.ctx.createGain();
      g.gain.setValueAtTime(gain || 0.03, t0);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

      src.connect(filt); filt.connect(g); g.connect(audioUI.master);
      src.start(t0);
      src.stop(t0 + dur + 0.02);
    }

    function unlockAudio(){
      if(!audioUI.enabled) return;
      if(!ensureAudio()) return;
      if(audioUI.unlocked) return;
      try{
        if(audioUI.ctx.state !== "running") audioUI.ctx.resume();
        var o = audioUI.ctx.createOscillator();
        var g = audioUI.ctx.createGain();
        g.gain.value = 0.0001;
        o.connect(g); g.connect(audioUI.master);
        o.frequency.value = 440;
        o.start();
        o.stop(audioUI.ctx.currentTime + 0.01);
        audioUI.unlocked = true;
      }catch(e){}
    }

    audioToggle.addEventListener("click", function(){
      audioUI.enabled = !audioUI.enabled;
      updateAudioUI();
      unlockAudio();
    });
    window.addEventListener("pointerdown", unlockAudio, { passive:true });

    var SFX = {
      tap: function(){ tone(560, 0.07, "sine", 0.075, 120); },
      soft: function(){ tone(320, 0.08, "triangle", 0.035, -20); },
      wrong: function(){ tone(220, 0.12, "sawtooth", 0.05, -40); noiseBurst(0.06, 0.03); },
      correct: function(){ tone(660, 0.06, "sine", 0.06, 90); setTimeout(function(){ tone(880,0.07,"sine",0.05,120); }, 50); },
      win: function(){ tone(740, 0.09, "triangle", 0.065, 90); setTimeout(function(){ tone(980,0.10,"triangle",0.055,140); }, 80); setTimeout(function(){ tone(1240,0.12,"sine",0.05,200); }, 160); },
      bubble: function(){ tone(640, 0.04, "sine", 0.02, 70); },
      charge: function(){ tone(250, 0.06, "triangle", 0.025, 40); }
    };

    // =======================
    // Global state + helpers
    // =======================
    var state = { metDay: null, tttWon: false };

    function showScreen(id){
      var screens = document.querySelectorAll(".screen");
      for(var i=0;i<screens.length;i++) screens[i].classList.remove("active");
      document.getElementById(id).classList.add("active");
      window.scrollTo({top: 0, behavior: "smooth"});
      if(id === "s4") startFinalEffects();
    }
    function pick(arr){ return arr[(Math.random() * arr.length) | 0]; }

    // =======================
    // SCREEN 1: Calendar
    // =======================
    var monthTitle = document.getElementById("monthTitle");
    var calendarGrid = document.getElementById("calendarGrid");
    var dowRow = document.getElementById("dowRow");
    var dateNote = document.getElementById("dateNote");
    var toS2 = document.getElementById("toS2");

    monthTitle.textContent = MONTH_NAME + " " + YEAR;
    var DOW = ["M","T","W","T","F","S","S"];
    dowRow.innerHTML = DOW.map(function(d){ return '<div class="dow">'+d+'</div>'; }).join("");

    function buildCalendar(){
      calendarGrid.innerHTML = "";
      for(var i=0;i<MONTH_START_DOW;i++){
        var b = document.createElement("div");
        b.className = "blank";
        calendarGrid.appendChild(b);
      }
      for(var d=1; d<=DAYS_IN_MONTH; d++){
        var btn = document.createElement("button");
        btn.className = "dateBtn";
        btn.type = "button";
        btn.textContent = String(d);
        btn.setAttribute("data-day", String(d));
        (function(day, el){
          el.addEventListener("click", function(){ selectDay(day, el); });
        })(d, btn);
        calendarGrid.appendChild(btn);
      }
    }

    function suggestCorrectDay(){
      var el = calendarGrid.querySelector('.dateBtn[data-day="'+CORRECT_DAY+'"]');
      if(!el) return;
      el.classList.add("suggest");
      setTimeout(function(){ el.classList.remove("suggest"); }, 1200);
    }

    function distanceBucket(diff){
      if(diff === 0) return "exact";
      if(diff === 1) return "one";
      if(diff <= 3) return "near";
      if(diff <= 7) return "mid";
      return "far";
    }

    function wrongDayMessage(day){
      var diff = Math.abs(day - CORRECT_DAY);
      var bucket = distanceBucket(diff);
      var msgs = {
        one: [
          "Oof‚Ä¶ SO close üò≠ Just one day away üíó",
          "Almost! You‚Äôre literally 1 day off üòå‚ú®",
          "My heart says‚Ä¶ one tiny step üíû"
        ],
        near: [
          "Closeee üòå Try the glowing date üíó",
          "You‚Äôre warm üî•üíó The ring will guide you",
          "Not perfect‚Ä¶ but cute attempt ü•∫üíû"
        ],
        mid: [
          "Hmm‚Ä¶ not quite üòå Follow the glowing ring üíó",
          "A little off‚Ä¶ but I like the confidence üòè‚ú®",
          "We‚Äôre drifting üò≠ Find the shining date üíû"
        ],
        far: [
          "That‚Äôs‚Ä¶ very wrong üò≠üòÇ The glow will save you üíó",
          "Aww nooo üôà That‚Äôs far‚Ä¶ look for the shining ring ‚ú®",
          "My calendar just panicked üòÇüíó Follow the glow"
        ],
        exact: [
          "YESSS üòç " + MONTH_NAME + " " + CORRECT_DAY + ", " + YEAR + " üíó",
          "Perfect! You remembered ü•πüíû " + MONTH_NAME + " " + CORRECT_DAY + ", " + YEAR,
          "That‚Äôs the one! My heart approves üíò"
        ]
      };
      return pick(msgs[bucket] || msgs.mid);
    }

    // IMPORTANT: Next unlocks only if correct date
    function selectDay(day, btn){
      SFX.tap();
      state.metDay = day;

      var all = document.querySelectorAll(".dateBtn");
      for(var i=0;i<all.length;i++) all[i].classList.remove("selected");
      btn.classList.add("selected");

      if(day !== CORRECT_DAY){
        toS2.disabled = true;
        dateNote.textContent = wrongDayMessage(day);
        suggestCorrectDay();
        SFX.wrong();
      } else {
        toS2.disabled = false;
        dateNote.textContent = wrongDayMessage(day);
        SFX.correct();
      }

      gsap.fromTo(btn, {scale:0.96}, {scale:1.03, duration:0.16, ease:"power2.out", yoyo:true, repeat:1});
    }

    buildCalendar();

    toS2.addEventListener("click", function(){
      SFX.correct();
      showScreen("s2");
      initTTT();
    });

    // =======================
    // SCREEN 2: TicTacToe (user always wins)
    // =======================
    var tttBoard = document.getElementById("tttBoard");
    var tttStatus = document.getElementById("tttStatus");
    var tttTopWin = document.getElementById("tttTopWin");
    var winSvg = document.getElementById("winSvg");
    var toS3 = document.getElementById("toS3");
    var resetTTT = document.getElementById("resetTTT");

    var USER = "üíó";
    var AI = "üñ§";
    var LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    var board = Array(9).fill(null);
    var userMoves = 0;
    var locked = false;

    function renderTTT(){
      tttBoard.innerHTML = "";
      board.forEach(function(v, i){
        var c = document.createElement("div");
        c.className = "cell";
        c.setAttribute("data-i", String(i));
        c.textContent = v ? v : "";
        if(v) c.classList.add("pop");
        c.addEventListener("click", function(){ onUserMove(i); });
        tttBoard.appendChild(c);
      });
    }

    function animateCell(i){
      var el = tttBoard.querySelector('.cell[data-i="'+i+'"]');
      if(!el) return;
      gsap.fromTo(el, {scale:0.88}, {scale:1.04, duration:0.18, ease:"power2.out", yoyo:true, repeat:1});
    }

    function winningLine(sym){
      for(var k=0;k<LINES.length;k++){
        var line = LINES[k];
        if(line.every(function(idx){ return board[idx] === sym; })) return line;
      }
      return null;
    }

    function bestLineForUser(){
      var best = null;
      var bestCount = -1;
      for(var k=0;k<LINES.length;k++){
        var line = LINES[k];
        var aiCount = line.filter(function(i){ return board[i] === AI; }).length;
        if(aiCount > 0) continue;
        var uCount = line.filter(function(i){ return board[i] === USER; }).length;
        if(uCount > bestCount){
          bestCount = uCount;
          best = line;
        }
      }
      return best || LINES[0];
    }

    function hintBestMove(){
      var cells = tttBoard.querySelectorAll(".cell");
      for(var i=0;i<cells.length;i++) cells[i].classList.remove("hint");
      var line = bestLineForUser();
      var empty = null;
      for(var j=0;j<line.length;j++){
        if(!board[line[j]]){ empty = line[j]; break; }
      }
      if(empty !== null){
        var el = tttBoard.querySelector('.cell[data-i="'+empty+'"]');
        if(el) el.classList.add("hint");
      }
    }

    function aiMoveSoft(){
      if(winningLine(USER)) return;
      var line = bestLineForUser();
      var avoid = new Set(line);

      var empties = [];
      for(var i=0;i<board.length;i++) if(!board[i]) empties.push(i);

      var choices = empties.filter(function(i){ return !avoid.has(i); });
      if(choices.length === 0) choices = empties;

      var pickI = choices[Math.floor(Math.random()*choices.length)];
      board[pickI] = AI;
      renderTTT();
      animateCell(pickI);
      SFX.soft();
    }

    function forceUserWin(){
      var line = bestLineForUser();
      for(var j=0;j<line.length;j++){
        var idx = line[j];
        if(!board[idx]){
          board[idx] = USER;
          renderTTT();
          animateCell(idx);
          SFX.tap();
          break;
        }
      }
      if(winningLine(USER)) winTTT();
    }

    function countInLine(sym, line){ return line.filter(function(i){ return board[i] === sym; }).length; }
    function emptyInLine(line){ return line.filter(function(i){ return !board[i]; }).length; }
    function userAlmostWinning(){ return LINES.some(function(line){ return countInLine(USER,line)===2 && emptyInLine(line)===1; }); }
    function userCloseLines(){ return LINES.some(function(line){ return countInLine(USER,line)===1 && emptyInLine(line)===2; }); }

    function onUserMove(i){
      if(locked) return;
      if(board[i]) return;

      board[i] = USER;
      userMoves++;
      renderTTT();
      animateCell(i);
      SFX.tap();

      if(winningLine(USER)){ winTTT(); return; }

      if(userAlmostWinning()){
        tttStatus.textContent = pick(["OMG one more and you win üò≥üíû","Final move incoming‚Ä¶ üòåüíó","So close I can feel it ü•πüíò"]);
      } else if(userCloseLines()){
        tttStatus.textContent = pick(["That was cute üòåüíó","Okayyy I see you üëÄüíû","Ooo this is getting serious üíò"]);
      } else {
        tttStatus.textContent = pick(["Your turn üíó","Go on üòå","Make it count üíò"]);
      }

      locked = true;
      setTimeout(function(){
        aiMoveSoft();
        locked = false;
        if(winningLine(USER)){ winTTT(); return; }
        if(userMoves >= 4) forceUserWin();
        hintBestMove();
      }, 230);
    }

    function drawWinLine(line){
      var a = tttBoard.querySelector('.cell[data-i="'+line[0]+'"]');
      var c = tttBoard.querySelector('.cell[data-i="'+line[2]+'"]');
      if(!a || !c) return;

      var br = tttBoard.getBoundingClientRect();
      var ar = a.getBoundingClientRect();
      var cr = c.getBoundingClientRect();

      var x1 = (ar.left + ar.width/2) - br.left;
      var y1 = (ar.top + ar.height/2) - br.top;
      var x2 = (cr.left + cr.width/2) - br.left;
      var y2 = (cr.top + cr.height/2) - br.top;

      winSvg.setAttribute("viewBox", "0 0 " + br.width + " " + br.height);
      winSvg.innerHTML =
        '<path id="p" d="M '+x1+' '+y1+' L '+x2+' '+y2+'" stroke="rgba(181,22,82,.85)" stroke-width="8" stroke-linecap="round" fill="none" opacity="0.95"/>' +
        '<text id="heartEnd" x="'+x2+'" y="'+y2+'" text-anchor="middle" dominant-baseline="middle" style="font-size:22px; filter: drop-shadow(0 12px 16px rgba(181,22,82,.18));">üíó</text>';

      var path = winSvg.querySelector("#p");
      var heart = winSvg.querySelector("#heartEnd");
      var len = path.getTotalLength();

      path.style.strokeDasharray = String(len);
      path.style.strokeDashoffset = String(len);

      gsap.to(path, { strokeDashoffset: 0, duration: 0.45, ease: "power2.out" });
      gsap.fromTo(path, { opacity: 0.65 }, { opacity: 1, duration: 0.18, yoyo: true, repeat: 3, ease: "power2.inOut" });
      gsap.fromTo(heart, { scale: 0.9 }, { scale: 1.22, duration: 0.18, yoyo: true, repeat: 3, ease: "power2.inOut",
        transformOrigin: "50% 50%"
      });
    }

    function winTTT(){
      state.tttWon = true;
      var line = winningLine(USER);
      if(line) drawWinLine(line);

      tttTopWin.textContent = "YOU HAVE WON MY HEART üíû";
      tttTopWin.classList.add("glow");
      setTimeout(function(){ tttTopWin.classList.remove("glow"); }, 1300);

      tttStatus.textContent = pick(["Okay okay‚Ä¶ you win üòåüíó","I surrender ü•πüíû","Fine‚Ä¶ take my heart üíò"]);
      toS3.disabled = false;

      SFX.win();
      confetti({ particleCount: 90, spread: 70, startVelocity: 22, scalar: 0.9, origin: { y: 0.55 } });
    }

    function initTTT(){
      state.tttWon = false;
      toS3.disabled = true;
      tttTopWin.textContent = "";
      tttTopWin.classList.remove("glow");
      winSvg.innerHTML = "";
      board = Array(9).fill(null);
      userMoves = 0;
      locked = false;
      tttStatus.textContent = "Your turn üíó";
      renderTTT();
      hintBestMove();
    }

    resetTTT.addEventListener("click", function(){ SFX.wrong(); initTTT(); });

    toS3.addEventListener("click", function(){
      SFX.correct();
      showScreen("s3");
      initCatchGame();
    });

    // =======================
    // SCREEN 3: Catch Hearts (no permissions)
    // =======================
    var cutieInline = document.getElementById("cutieNameInline");
    cutieInline.textContent = CUTIE_NAME;

    var valEmoji = document.getElementById("valEmoji");
    var valMood = document.getElementById("valMood");
    var valSub = document.getElementById("valSub");

    var arena = document.getElementById("arena");
    var catchField = document.getElementById("catchField");
    var basket = document.getElementById("basket");
    var catchHint = document.getElementById("catchHint");

    var hudScore = document.getElementById("hudScore");
    var hudMiss  = document.getElementById("hudMiss");
    var hudCharge = document.getElementById("hudCharge");

    var toast = document.getElementById("toast");
    var toastText = document.getElementById("toastText");
    var dust = document.getElementById("dust");

    var yesBtn = document.getElementById("yesBtn");
    var yesText = document.getElementById("yesText");
    var chargePct = document.getElementById("chargePct");
    var wave = document.getElementById("wave");
    var fizz = document.getElementById("fizz");

    // charge
    var charge = 0;
    var charging = false;
    var chargeRaf = null;
    var lastTs = 0;
    var fizzTimer = null;

    function setCharge(p){
      charge = Math.max(0, Math.min(100, p));
      wave.style.height = String(charge) + "%";
      wave.style.transform = "translateY(" + (8 - (charge*0.08)) + "px)";
      chargePct.textContent = String(Math.round(charge)) + "%";
      hudCharge.textContent = "üíò YES: " + String(Math.round(charge)) + "%";

      if(charge < 20) yesText.textContent = "Hold to say YES üíò";
      else if(charge < 55) yesText.textContent = "It‚Äôs getting fizzy‚Ä¶ ü´ß";
      else if(charge < 90) yesText.textContent = "Almost there‚Ä¶ ü•πüíó";
      else yesText.textContent = "Release to seal it üíû";

      if(charge >= 100){
        acceptYes();
      }
    }

    function spawnFizzBubble(intensity){
      if(charge <= 1) return;
      var b = document.createElement("span");
      b.className = "fizzBubble";

      var w = yesBtn.clientWidth;
      var x = 8 + Math.random()*(w - 16);
      var size = 2 + Math.random()*6*(intensity || 1);
      b.style.width = size + "px";
      b.style.height = size + "px";
      b.style.left = x + "px";
      b.style.bottom = (6 + Math.random()*14) + "px";
      fizz.appendChild(b);

      var rise = 26 + Math.random()*28 + (intensity || 1)*12;
      var drift = (-12 + Math.random()*24) * (intensity || 1);
      var dur = 0.6 + Math.random()*0.55;

      gsap.fromTo(b,
        { opacity: 0, y: 0, x: 0, scale: 0.85 },
        { opacity: 0.9, duration: 0.10, ease:"power2.out", onComplete: function(){
          gsap.to(b, {
            y: -rise,
            x: drift,
            opacity: 0,
            scale: 1.25,
            duration: dur,
            ease: "power1.out",
            onComplete: function(){ if(b && b.remove) b.remove(); }
          });
        }}
      );

      if(Math.random() < 0.22) SFX.bubble();
    }

    function spawnFizzBurst(power){
      var n = 10 + Math.floor((power || 1) * 10);
      for(var i=0;i<n;i++){
        (function(ii){
          setTimeout(function(){ spawnFizzBubble(1 + (power || 1)*0.5); }, ii * 20);
        })(i);
      }
    }

    function startFizz(){
      if(fizzTimer) return;
      fizzTimer = setInterval(function(){
        if(!charging) return;
        spawnFizzBubble(1.1);
        if(Math.random() < 0.55) spawnFizzBubble(1.1);
      }, 140);
    }
    function stopFizz(){
      if(!fizzTimer) return;
      clearInterval(fizzTimer);
      fizzTimer = null;
    }

    function startCharging(){
      if(charging) return;
      if(yesBtn.dataset.done === "1") return;
      charging = true;
      lastTs = 0;
      startFizz();
      SFX.charge();

      var baseSpeed = 8; // still slow so game matters
      function tick(ts){
        if(!charging) return;
        if(!lastTs) lastTs = ts;
        var dt = (ts - lastTs) / 1000;
        lastTs = ts;

        setCharge(charge + baseSpeed * dt);

        // subtle wavy ‚Äúslosh‚Äù (no sensors)
        var sx = Math.sin(ts/260) * 6;
        var sy = Math.cos(ts/340) * 4;
        gsap.to(wave, { x: sx, y: sy, rotate: Math.sin(ts/300)*2.2, duration: 0.25, ease:"power2.out" });

        if(charge < 100) chargeRaf = requestAnimationFrame(tick);
      }
      chargeRaf = requestAnimationFrame(tick);
    }

    function stopCharging(){
      charging = false;
      if(chargeRaf) cancelAnimationFrame(chargeRaf);
      chargeRaf = null;
      stopFizz();

      if(charge < 100){
        gsap.to({p: charge}, {
          p: Math.max(0, charge - 8),
          duration: 0.35,
          ease: "power2.out",
          onUpdate: function(){ setCharge(this.targets()[0].p); }
        });
      }
    }

    yesBtn.addEventListener("pointerdown", function(e){
      e.preventDefault();
      startCharging();
    }, { passive:false });

    yesBtn.addEventListener("pointerup", function(e){
      e.preventDefault();
      stopCharging();
    }, { passive:false });

    yesBtn.addEventListener("pointercancel", stopCharging);
    yesBtn.addEventListener("pointerleave", function(){ if(charging) stopCharging(); });
    yesBtn.addEventListener("click", function(e){ e.preventDefault(); });

    // Catch game state
    var score = 0;
    var miss = 0;
    var basketX = 0; // center x in px (relative to field)
    var dragging = false;

    var drops = []; // {el, x, y, vy, kind, w, h}
    var spawnTimer = null;
    var rafGame = null;
    var lastFrame = 0;

    var heartMsgs = [
      "Cute catch üòåüíó",
      "Okayyy smooth ü•πüíû",
      "My heart noticed that üëÄüíò",
      "You‚Äôre collecting love like a pro ü´∂",
      "That was adorable üíó‚ú®",
      "Awwww üò≠üíû"
    ];
    var bombMsgs = [
      "Ouch üí£ ‚Äî love slipped a bit üò≠",
      "Bomb!? rude üò§ (charge down)",
      "Nooo üôà not the bomb",
      "My heart flinched üòµ‚Äçüí´"
    ];

    function setMood(emoji, text){
      valEmoji.textContent = emoji;
      valMood.textContent = text;
      gsap.fromTo(valEmoji, {scale:0.92, rotation:-2}, {scale:1.10, rotation:2, duration:0.18, ease:"power2.out", yoyo:true, repeat:1});
      gsap.fromTo(valMood, {opacity:0, y:6}, {opacity:1, y:0, duration:0.22, ease:"power2.out"});
    }

    function updateHud(){
      hudScore.textContent = "üíó Hearts: " + score;
      hudMiss.textContent  = "üôà Miss: " + miss;
      hudCharge.textContent = "üíò YES: " + String(Math.round(charge)) + "%";
    }

    function showToast(text, isBomb){
      toastText.textContent = text;
      toast.style.opacity = "1";
      toast.style.transform = "translateX(-50%) translateY(0)";
      toast.style.filter = "none";

      // Thanos-ish dust: small dots burst and fade
      dust.innerHTML = "";
      for(var i=0;i<18;i++){
        var d = document.createElement("i");
        d.style.left = (10 + Math.random()*80) + "%";
        d.style.top  = (10 + Math.random()*60) + "%";
        d.style.background = isBomb ? "rgba(43,15,29,.25)" : "rgba(181,22,82,.35)";
        dust.appendChild(d);

        gsap.fromTo(d,
          { opacity: 0, x: 0, y: 0, scale: 0.8 },
          { opacity: 1, duration: 0.08, ease:"power2.out", onComplete: (function(dd){
              return function(){
                gsap.to(dd, {
                  opacity: 0,
                  x: (-18 + Math.random()*36),
                  y: (-20 + Math.random()*40),
                  scale: 0.2,
                  duration: 0.55 + Math.random()*0.25,
                  ease:"power2.out"
                });
              };
          })(d)}
        );
      }

      gsap.fromTo(toast, {opacity:0, y:8, scale:0.98}, {opacity:1, y:0, scale:1, duration:0.18, ease:"power2.out"});
      setTimeout(function(){
        gsap.to(toast, {opacity:0, y:-8, duration:0.45, ease:"power2.out"});
      }, 900);
    }

    function setBasketByClientX(clientX){
      var r = catchField.getBoundingClientRect();
      var x = clientX - r.left;
      var half = basket.getBoundingClientRect().width / 2;
      var minX = half + 8;
      var maxX = r.width - half - 8;
      x = Math.max(minX, Math.min(maxX, x));
      basketX = x;
      basket.style.left = String(x) + "px";
      basket.style.transform = "translateX(-50%)";
    }

    function spawnDrop(){
      var r = catchField.getBoundingClientRect();
      var x = 16 + Math.random()*(r.width - 32);
      var isBomb = Math.random() < SPAWN_BOMB_CHANCE;
      var el = document.createElement("div");
      el.className = "drop " + (isBomb ? "bomb" : "heart");
      el.textContent = isBomb ? "üí£" : pick(["üíó","üíû","üíò","üíï","üíì"]);
      catchField.appendChild(el);

      var obj = {
        el: el,
        x: x,
        y: -40,
        vy: FALL_SPEED_PX_PER_SEC * (0.85 + Math.random()*0.6),
        kind: isBomb ? "bomb" : "heart",
        w: 0,
        h: 0
      };
      drops.push(obj);
    }

    function basketRect(){
      var br = basket.getBoundingClientRect();
      var fr = catchField.getBoundingClientRect();
      // return relative to field coords
      return {
        x: (br.left - fr.left),
        y: (br.top - fr.top),
        w: br.width,
        h: br.height
      };
    }

    function stepGame(ts){
      if(!lastFrame) lastFrame = ts;
      var dt = (ts - lastFrame) / 1000;
      lastFrame = ts;

      var fr = catchField.getBoundingClientRect();
      var b = basketRect();

      for(var i=drops.length-1;i>=0;i--){
        var d = drops[i];
        d.y += d.vy * dt;

        // apply
        d.el.style.transform = "translate(" + d.x + "px, " + d.y + "px)";

        // approximate size
        if(!d.w){
          var rr = d.el.getBoundingClientRect();
          d.w = rr.width; d.h = rr.height;
        }

        // collision (simple: if drop center is within basket pill)
        var cx = d.x;
        var cy = d.y + 10;

        var withinX = (cx > (b.x + 10)) && (cx < (b.x + b.w - 10));
        var withinY = (cy > (b.y - 10)) && (cy < (b.y + b.h - 8));

        if(withinX && withinY){
          // caught
          if(d.kind === "heart"){
            score++;
            setCharge(charge + HEART_VALUE);
            spawnFizzBurst(0.8);
            SFX.correct();
            setMood("ü•∞", pick(["Nice catch ü•∞üíó", "More love collected üíû", "My heart just smiled üòåüíò"]));
            showToast(pick(heartMsgs), false);
            confetti({ particleCount: 10, spread: 40, startVelocity: 16, scalar: 0.65, origin: { y: 0.72 } });
          } else {
            miss++;
            setCharge(charge - BOMB_PENALTY);
            SFX.wrong();
            setMood("ü•∫", pick(["Bomb üò≠", "Careful üôà", "Not the bomb ü•∫üíó"]));
            showToast(pick(bombMsgs), true);
          }

          updateHud();
          d.el.remove();
          drops.splice(i, 1);
          continue;
        }

        // missed (fell out)
        if(d.y > fr.height + 60){
          if(d.kind === "heart"){
            miss++;
            SFX.soft();
          }
          updateHud();
          d.el.remove();
          drops.splice(i, 1);
          continue;
        }
      }

      // subtle wavy motion on wave even while not holding
      var wavyX = Math.sin(ts/420) * 5;
      gsap.to(wave, { x: wavyX, rotate: Math.sin(ts/520)*2.2, duration:0.35, ease:"power2.out" });

      // win condition
      if(charge >= 100){
        return; // acceptYes will transition
      }

      rafGame = requestAnimationFrame(stepGame);
    }

    function startSpawning(){
      if(spawnTimer) return;
      spawnTimer = setInterval(function(){ spawnDrop(); }, SPAWN_HEART_EVERY_MS);
    }

    function stopSpawning(){
      if(!spawnTimer) return;
      clearInterval(spawnTimer);
      spawnTimer = null;
    }

    function startGameLoop(){
      lastFrame = 0;
      if(rafGame) cancelAnimationFrame(rafGame);
      rafGame = requestAnimationFrame(stepGame);
    }

    function stopGameLoop(){
      if(rafGame) cancelAnimationFrame(rafGame);
      rafGame = null;
    }

    function clearDrops(){
      for(var i=0;i<drops.length;i++){
        if(drops[i].el && drops[i].el.remove) drops[i].el.remove();
      }
      drops = [];
    }

    function initCatchGame(){
      // set subtitle with correct date
      valSub.innerHTML = "Since <span class='name'>" + MONTH_NAME + " " + CORRECT_DAY + ", " + YEAR + "</span>, I‚Äôve been smiling more.";

      // reset
      score = 0;
      miss = 0;
      setCharge(0);
      yesBtn.dataset.done = "0";
      updateHud();
      setMood("ü´∂", "Catch hearts to fill YES üíó");

      // clear field
      stopSpawning(); stopGameLoop();
      clearDrops();
      catchField.innerHTML = "";

      // place basket center
      setTimeout(function(){
        var fr = catchField.getBoundingClientRect();
        setBasketByClientX(fr.left + fr.width/2);
      }, 50);

      // show hint briefly
      catchHint.style.opacity = "1";
      setTimeout(function(){ gsap.to(catchHint, {opacity:0, duration:0.5, ease:"power2.out"}); }, 1800);

      // start
      startSpawning();
      startGameLoop();
    }

    // Drag basket (touch + mouse)
    catchField.addEventListener("pointerdown", function(e){
      dragging = true;
      setBasketByClientX(e.clientX);
    }, {passive:true});

    window.addEventListener("pointermove", function(e){
      if(!dragging) return;
      setBasketByClientX(e.clientX);
    }, {passive:true});

    window.addEventListener("pointerup", function(){
      dragging = false;
    }, {passive:true});

    // Win from holding YES too (still possible)
    function acceptYes(){
      if(yesBtn.dataset.done === "1") return;
      yesBtn.dataset.done = "1";

      stopSpawning();
      stopGameLoop();
      stopCharging();
      clearDrops();

      setMood("üòç", "Yesss‚Ä¶ you just made my whole heart blush üíó");
      SFX.win();
      confetti({ particleCount: 170, spread: 75, startVelocity: 32, scalar: 0.95, origin: { y: 0.6 } });
      setTimeout(function(){
        confetti({ particleCount: 120, spread: 110, startVelocity: 26, scalar: 0.85, origin: { y: 0.55 } });
      }, 160);

      document.getElementById("finalLine1").textContent = "You have won my heart, " + CUTIE_NAME + ".";
      document.getElementById("finalLine2").textContent = "And I‚Äôll never forget " + MONTH_NAME + " " + CORRECT_DAY + ", " + YEAR + ". üíó";

      renderCheesyCards();
      setTimeout(function(){ showScreen("s4"); }, 520);
    }

    // =======================
    // SCREEN 4: Final
    // =======================
    var cheesyGrid = document.getElementById("cheesyGrid");
    var heartLayer = document.getElementById("heartLayer");
    var finalHeartsTimer = null;

    function renderCheesyCards(){
      var cards = [
        { icon:"üëª", title:"Ghost Hug", text:"You can‚Äôt see it‚Ä¶ but it‚Äôs always there." },
        { icon:"ü´Ç", title:"Hugs Speak", text:"Hugs speak louder than words. Always." },
        { icon:"üåç", title:"Wherever You Are", text:"No distance can change this: I love you." },
        { icon:"üìà", title:"My Love Graph", text:"It‚Äôs increasing‚Ä¶ day by day. (No limit üòå)" },
        { icon:"üìê", title:"If you were an angle‚Ä¶", text:"You‚Äôd be A-CUTE-ONE üíó" },
        { icon:"üìù", title:"Thank You", text:"For being you. For existing. For making me smile." }
      ];

      cheesyGrid.innerHTML = cards.map(function(c){
        return ''+
          '<div class="noteCard">'+
            '<div class="noteIcon">'+c.icon+'</div>'+
            '<div class="noteTitle">'+c.title+'</div>'+
            '<div class="noteText">'+c.text+'</div>'+
          '</div>';
      }).join("");
    }

    function spawnFloatingHeart(){
      var hearts = ["üíó","üíû","üíò","üíï","üíì"];
      var el = document.createElement("div");
      el.className = "floatHeart";
      el.textContent = pick(hearts);

      var w = heartLayer.clientWidth;
      var h = heartLayer.clientHeight;

      var x = 12 + Math.random()*(w - 24);
      var startY = h + 10;
      var endY = -40 - Math.random()*60;

      el.style.left = x + "px";
      el.style.top = startY + "px";
      el.style.fontSize = (14 + Math.random()*12) + "px";
      heartLayer.appendChild(el);

      var driftX = -30 + Math.random()*60;
      var rot = -18 + Math.random()*36;

      gsap.fromTo(el,
        { opacity: 0, y: 0, x: 0, rotation: 0, scale: 0.9 },
        { opacity: 0.85, duration: 0.18, ease: "power2.out",
          onComplete: function(){
            gsap.to(el, {
              y: endY - startY,
              x: driftX,
              rotation: rot,
              opacity: 0,
              scale: 1.15,
              duration: 2.8 + Math.random()*1.6,
              ease: "power1.out",
              onComplete: function(){ if(el && el.remove) el.remove(); }
            });
          }
        }
      );
    }

    function startFinalEffects(){
      SFX.win();
      confetti({ particleCount: 120, spread: 80, startVelocity: 28, scalar: 0.95, origin: { y: 0.55 } });
      setTimeout(function(){
        confetti({ particleCount: 90, spread: 120, startVelocity: 22, scalar: 0.8, origin: { y: 0.5 } });
      }, 180);

      heartLayer.innerHTML = "";
      if(finalHeartsTimer) clearInterval(finalHeartsTimer);
      finalHeartsTimer = setInterval(spawnFloatingHeart, 220);

      setTimeout(function(){
        if(finalHeartsTimer) clearInterval(finalHeartsTimer);
        finalHeartsTimer = null;
      }, 9000);
    }

    // =======================
    // Replay
    // =======================
    document.getElementById("replay").addEventListener("click", function(){
      SFX.wrong();
      state.metDay = null;

      // reset calendar UI
      var all = document.querySelectorAll(".dateBtn");
      for(var i=0;i<all.length;i++) all[i].classList.remove("selected");
      dateNote.textContent = "Pick the right day to unlock ‚ÄúNext‚Äù üòå";
      toS2.disabled = true;

      initTTT();
      showScreen("s1");
    });

    // init
    buildCalendar();
    initTTT();
  </script>
</body>
</html>
